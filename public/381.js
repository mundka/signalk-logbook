"use strict";(self.webpackChunksignalk_logbook=self.webpackChunksignalk_logbook||[]).push([[381],{7619:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ze});var r=n(4823),l=n.n(r),o=n(9217),i=n(527),a=n(6664),c=n(7299),u=n(6980),s=n(3481),m=n(6644),d=n(4745),f=n(1883),g=n(949),y=n(1631),p=n.n(y),v=n(2706),b=n(3325),E=n(6768),h=n(26),A=n(7237),S=n(7587),x=n(4428),w=n(727),N=n(8337),k=n(8255);function O(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||C(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(e,t)||C(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const P=function(e){var t=j((0,r.useState)(e.crewNames),2),n=t[0],o=t[1],i=j((0,r.useState)(n.includes(e.username)?"":e.username),2),a=i[0],c=i[1];function u(){if(a){var e=[].concat(O(n),[a]);o(e),c("")}}return l().createElement(v.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},"Crew"),l().createElement(E.A,null,l().createElement(h.A,{flush:!0},n.map(function(e,t){return l().createElement(A.A,{key:e},l().createElement(g.A,{onClick:function(){var e=O(n);e.splice(t,1),o(e)}},"X")," ",e)})),l().createElement(S.A,null,l().createElement(x.A,null,l().createElement(w.A,{for:"add"},"Add crew"),l().createElement(N.A,{id:"add",name:"add",placeholder:"bergie",color:"primary",value:a,onChange:function(e){var t=e.target.value;c(t)},onKeyPress:function(e){"Enter"===e.key&&(u(),e.stopPropagation(),e.preventDefault())}}),l().createElement(g.A,{onClick:u},"Add")))),l().createElement(k.A,null,l().createElement(g.A,{color:"primary",onClick:function(){return e.save(n)}},"Save")," ",l().createElement(g.A,{color:"secondary",onClick:e.cancel},"Cancel")))};function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const M=function(e){var t,n,o=(t=(0,r.useState)(e.daysToShow),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[0],a=o[1];return l().createElement(v.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},"Filter logs by"),l().createElement(E.A,null,l().createElement(S.A,null,l().createElement(x.A,null,l().createElement(w.A,{for:"text"},"How many days to show"),l().createElement(N.A,{id:"daysToShow",name:"daysToShow",type:"number",min:1,value:i,onChange:function(e){var t=e.target.value;a(parseInt(t,10))}})))),l().createElement(k.A,null,l().createElement(g.A,{color:"primary",onClick:function(){e.save({daysToShow:i})}},"Save")," ",l().createElement(g.A,{color:"secondary",onClick:e.cancel},"Cancel")))};function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return W(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const L=function(e){var t=I((0,r.useState)(!1),2),n=t[0],a=t[1],c=I((0,r.useState)(!1),2),u=c[0],s=c[1],m=I((0,r.useState)([]),2),y=m[0],v=m[1],b=["communication.crewNames"],E=[];function h(e){var t=JSON.parse(e.data);t.updates&&t.updates.forEach(function(e){e.values&&e.values.forEach(function(e){"communication.crewNames"!==e.path||JSON.stringify(y)!==JSON.stringify(e.value)&&v(e.value)})})}return(0,r.useEffect)(function(){var t;return fetch("/signalk/v1/api/vessels/self/communication/crewNames").then(function(e){return e.json()},function(){return[]}).then(function(e){return JSON.stringify(y)!==JSON.stringify(e.value)?(v(e.value),Promise.reject(new Error("Skip"))):Promise.resolve()}).then(function(){(t=e.adminUI.openWebsocket({subscribe:"none"})).onopen=function(){t.send(JSON.stringify({context:"vessels.self",subscribe:b.map(function(e){return{path:e,period:1e4}})}))},t.onmessage=h}).catch(function(){}),function(){t&&t.close()}},[y]),l().createElement(o.A,{xs:!0},n?l().createElement(P,{crewNames:y,cancel:function(){return a(!1)},save:function(t){fetch("/signalk/v1/api/vessels/self/communication/crewNames",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:t})}).then(function(){a(!1),v(t),setTimeout(function(){e.setNeedsUpdate(!0)},1e3)})},username:e.loginStatus.username}):null,u?l().createElement(M,{cancel:function(){return s(!1)},daysToShow:e.daysToShow,save:function(t){fetch("/signalk/v1/applicationData/user/signalk-logbook/1.0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:t})}).then(function(){s(!1),e.setDaysToShow(t.daysToShow),e.setNeedsUpdate(!0)})}}):null,l().createElement(i.A,null,l().createElement(d.A,{type:"unstyled"},l().createElement(f.A,null,l().createElement("b",null,"Crew")),y.map(function(e){return l().createElement(f.A,{key:e,onClick:function(){return a(!0)}},e)}),!y.length&&l().createElement(g.A,{onClick:function(){return a(!0)},size:"sm"},"Edit"))),l().createElement(i.A,null,l().createElement(d.A,{type:"unstyled"},l().createElement(f.A,null,l().createElement("b",null,"Show")),l().createElement(f.A,{onClick:function(){return s(!0)}},"Last ",e.daysToShow," days"))),l().createElement(i.A,{className:"text-end text-right"},l().createElement(d.A,{type:"unstyled"},l().createElement(f.A,null,l().createElement("b",null,"Sails")),E.map(function(e){var t="";return e.reducedState&&e.reducedState.reefs&&(t=" (".concat(p()(e.reducedState.reefs)," reef)")),e.reducedState&&e.reducedState.furledRatio&&(t=" (".concat(100*e.reducedState.furledRatio,"% furled)")),l().createElement(f.A,{key:e.id,onClick:function(){}},e.name,t)}),!E.length&&l().createElement(g.A,{onClick:function(){}},"Edit"))))};var B=n(7185),R=n(2237),z=n(937);function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach(function(t){Z(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Z(e,t,n){return(t=function(e){var t=function(e){if("object"!=G(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==G(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e){switch(e){case"navigation":return l().createElement(z.iq2,{style:{color:"#007bff"},title:"Navigation"});case"engine":return l().createElement(z.Pcn,{style:{color:"#28a745"},title:"Engine"});case"radio":return l().createElement(z.Uhg,{style:{color:"#ffc107"},title:"Radio"});case"maintenance":return l().createElement(z.Ph,{style:{color:"#dc3545"},title:"Maintenance"});default:return l().createElement(z.iq2,{style:{color:"#6c757d"},title:"Unknown"})}}const _=function(e){var t=function(e){var t={};e.forEach(function(e){t[e.datetime]=e});var n=e.filter(function(t){return!e.some(function(e){return e.amends===t.datetime})}).map(function(e){for(var n=[e],r=e;r.amends;){var l=t[r.amends];if(!l)break;n.unshift(l),r=l}return n});return n.sort(function(e,t){return new Date(t[t.length-1].datetime)-new Date(e[e.length-1].datetime)}),n}(e.entries.map(function(e){return U(U({},e),{},{point:e.position?new R.Point(e.position.latitude,e.position.longitude):null,date:new Date(e.datetime)})}));return l().createElement("div",null,l().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},l().createElement("div",{style:{fontWeight:"bold"}},"Logbook",e.userRole&&l().createElement("span",{style:{fontSize:"0.8em",color:"#6c757d",marginLeft:"10px"}},"(",e.userRole," - ",e.canWrite?"Read/Write":"Read Only",")")),e.addEntry&&l().createElement(g.A,{color:"primary",onClick:e.addEntry},"Add entry")),l().createElement(B.A,{striped:!0,hover:!0,responsive:!0},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",{style:{textAlign:"center",width:"40px"}},"Type"),l().createElement("th",null,"Time"),l().createElement("th",null,"Course"),l().createElement("th",null,"Speed"),l().createElement("th",null,"Weather"),l().createElement("th",null,"Coordinates"),l().createElement("th",null,"Fix"),l().createElement("th",null,"speed"),l().createElement("th",null,"Engine"),l().createElement("th",null,"By"),l().createElement("th",null,"Remarks"))),l().createElement("tbody",null,t.map(function(t,n){var r,o=t[t.length-1];return l().createElement(l().Fragment,{key:o.datetime},l().createElement("tr",{onClick:e.editEntry?function(){return e.editEntry(o)}:void 0,style:{cursor:e.editEntry?"pointer":"default"}},l().createElement("td",{style:{textAlign:"center",width:"40px"}},V(o.category)),l().createElement("td",null,o.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})),l().createElement("td",null,(r=o,Number.isNaN(Number(r.course))?Number.isNaN(Number(r.heading))?"":"HDT ".concat(r.heading,"°"):"".concat(r.course,"°"))),l().createElement("td",null,o.speed&&!Number.isNaN(Number(o.speed.sog))?"".concat(o.speed.sog,"kt"):""),l().createElement("td",null,function(e){var t=[];if(e.wind){var n=[];Number.isNaN(Number(e.wind.speed))||n.push("".concat(e.wind.speed,"kt")),Number.isNaN(Number(e.wind.direction))||n.push("".concat(e.wind.direction,"°")),n.length&&t.push("Wind ".concat(n.join(" ")))}return e.observations&&(Number.isNaN(Number(e.observations.seaState))||t.push("Sea state ".concat(e.observations.seaState)),Number.isNaN(Number(e.observations.cloudCoverage))||t.push("Clouds ".concat(e.observations.cloudCoverage,"/8")),Number.isNaN(Number(e.observations.visibility))||t.push("Visibility ".concat(e.observations.visibility+1))),t.join(", ")}(o)),l().createElement("td",null,o.point?o.point.toString():"n/a"),l().createElement("td",null,o.position?o.position.source||"GPS":""),l().createElement("td",null,o.speed&&!Number.isNaN(Number(o.speed.sog||o.speed.stw))?"".concat(Number(o.speed.sog||o.speed.stw),"kt"):""),l().createElement("td",null,o.engine&&!Number.isNaN(Number(o.engine.hours))?"".concat(o.engine.hours,"h"):""),l().createElement("td",null,o.author||"auto",!1===o.signatureValid&&l().createElement("span",{title:"Logikirje on muudetud või rikutud",style:{color:"red",marginLeft:4}},l().createElement(z.BS8,null))),l().createElement("td",null,o.text)),t.length>1&&t.slice(0,-1).map(function(t,n){return l().createElement("tr",{key:t.datetime,style:{background:"#f6f6f6",fontSize:"0.95em"}},l().createElement("td",{style:{textAlign:"center",width:"40px"}},V(t.category)),l().createElement("td",{colSpan:11,style:{paddingLeft:48,borderLeft:"3px solid #bbb"}},l().createElement("span",{style:{color:"#888"}},l().createElement("b",null,t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone}))," — ",t.text)))}))}))),l().createElement(g.A,{color:"primary",onClick:e.addEntry},"Add entry"))};var H=n(1425),K=n(2728);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(e,t)||ee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach(function(t){X(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function X(e,t,n){return(t=function(e){var t=function(e){if("object"!=J(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==J(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e){return function(e){if(Array.isArray(e))return te(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ee(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){if(e){if("string"==typeof e)return te(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?te(e,t):void 0}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const ne=function(e){var t=e.entries.filter(function(e){return e.position}).map(function(e){return Y(Y({},e),{},{point:new R.Point(e.position.latitude,e.position.longitude),date:new Date(e.datetime)})}),n=$((0,r.useState)(t.map(function(e){return{lat:e.position.latitude,lon:e.position.longitude}})),2),o=n[0],i=n[1],a=$((0,r.useState)([640,480]),2),c=a[0],u=a[1],s=(0,r.useRef)(null);(0,r.useEffect)(function(){if(s.current){var e=s.current.getBoundingClientRect();u([e.width,e.height])}},[]);var m=(0,K.R)(function(e){if(!e.length)return[0,0,0,0];var t=e.map(function(e){return e.lon}),n=e.map(function(e){return e.lat});return[Math.min.apply(Math,Q(n)),Math.min.apply(Math,Q(t)),Math.max.apply(Math,Q(n)),Math.max.apply(Math,Q(t))]}(o),c);m.zoom-=1.5,(0,r.useEffect)(function(){if(!(t.length<2)){var e=t.reduce(function(e,t){var n=t.datetime.substr(0,10);return-1===e.indexOf(n)&&e.push(n),e},[]),n=t[0].datetime,r=t[t.length-1].datetime;fetch("/signalk/v1/history/values?from=".concat(n,"&to=").concat(r,"&paths=navigation.position&resolution=").concat(300)).then(function(e){return e.json()}).then(function(t){if(t.data&&t.data.length){var n,r=[];t.data.forEach(function(t){if(t.length&&-1!==e.indexOf(t[0].substr(0,10))&&t[1]){var l=new R.Point(t[1][1],t[1][0]);n&&n.distanceTo(l)<.04||(n=l,r.push({lat:l.lat,lon:l.lon}))}}),i(r)}}).catch(function(){})}},[e.entries]);var d={type:"FeatureCollection",features:o.slice(1).map(function(e,t){var n=o[t];return!n||Number.isNaN(Number(n.lat))||Number.isNaN(Number(n.lon))||!e||Number.isNaN(Number(e.lat))||Number.isNaN(Number(e.lon))?null:{type:"feature",geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[e.lon,e.lat]]}}}).filter(function(e){return null!==e})};return l().createElement("div",{ref:s,style:{width:"80vw",height:"80vh"}},l().createElement(H.T5,{center:m.center,zoom:m.zoom},l().createElement(H.s7,{data:d,styleCallback:function(){return{strokeWidth:"1",stroke:"red"}}}),t.map(function(t){var n="#009bdb";return"engine"===t.category&&(n="#ed1b2f"),"radio"===t.category&&(n="#00ae9d"),l().createElement(H.pH,{key:t.datetime,color:n,anchor:[t.position.latitude,t.position.longitude],onClick:function(){return e.viewEntry(t)}})})))};var re=n(8447),le=n(8702),oe=n(1187),ie=n(2223);function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ce(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const ue=function(e){var t=ae((0,r.useState)([]),2),n=t[0],o=t[1],i=ae((0,r.useState)(null),2),a=i[0],c=i[1],u=ae((0,r.useState)([]),2),s=u[0],m=u[1],d=ae((0,r.useState)(!1),2),f=d[0],y=d[1],p=ae((0,r.useState)(null),2),h=p[0],A=p[1];function S(e){return new Date(e).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}return(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){o(e.sort().reverse())}).catch(function(e){console.error("Error fetching days:",e)})},[]),l().createElement("div",null,l().createElement(re.A,null,l().createElement(le.A,null,l().createElement("h4",null,"Service - Log Management"),l().createElement("p",{className:"text-muted mb-0"},"Delete log entries by day. This action cannot be undone.")),l().createElement(oe.A,null,"success"===h&&l().createElement(ie.A,{color:"success",onDismiss:function(){return A(null)}},"Day deleted successfully!"),"error"===h&&l().createElement(ie.A,{color:"danger",onDismiss:function(){return A(null)}},"Error deleting day. Please try again."),l().createElement("div",{className:"row"},l().createElement("div",{className:"col-md-6"},l().createElement("h5",null,"Available Days"),l().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},n.map(function(e){return l().createElement(re.A,{key:e,className:"mb-2 ".concat(a===e?"border-primary":""),style:{cursor:"pointer"},onClick:function(){return function(e){c(e),fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()}).then(function(e){m(e)}).catch(function(e){console.error("Error fetching entries:",e),m([])})}(e)}},l().createElement(oe.A,{className:"py-2"},l().createElement("div",{className:"d-flex justify-content-between align-items-center"},l().createElement("div",null,l().createElement("strong",null,S(e)),l().createElement("br",null),l().createElement("small",{className:"text-muted"},e)),a===e&&l().createElement(g.A,{color:"danger",size:"sm",onClick:function(e){e.stopPropagation(),y(!0)}},"Delete"))))}),0===n.length&&l().createElement("p",{className:"text-muted"},"No log entries found."))),l().createElement("div",{className:"col-md-6"},l().createElement("h5",null,"Entries for Selected Day"),a&&s.length>0?l().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},l().createElement(B.A,{size:"sm"},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",null,"Time"),l().createElement("th",null,"Category"),l().createElement("th",null,"Text"),l().createElement("th",null,"Author"))),l().createElement("tbody",null,s.map(function(t){return l().createElement("tr",{key:t.datetime},l().createElement("td",null,(n=t.datetime,new Date(n).toLocaleTimeString("en-GB",{timeZone:e.displayTimeZone||"UTC",hour:"2-digit",minute:"2-digit"}))),l().createElement("td",null,l().createElement("span",{className:"badge bg-".concat("navigation"===t.category?"primary":"engine"===t.category?"danger":"radio"===t.category?"success":"secondary")},t.category)),l().createElement("td",null,l().createElement("div",{style:{maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"}},t.text)),l().createElement("td",null,t.author||"auto"));var n})))):a?l().createElement("p",{className:"text-muted"},"No entries found for this day."):l().createElement("p",{className:"text-muted"},"Select a day to view entries."))))),l().createElement(v.A,{isOpen:f,toggle:function(){return y(!1)}},l().createElement(b.A,{toggle:function(){return y(!1)}},"Confirm Delete"),l().createElement(E.A,null,"Are you sure you want to delete all log entries for ",l().createElement("strong",null,a?S(a):""),"?",l().createElement("br",null),l().createElement("br",null),"This action cannot be undone and will permanently remove ",s.length," log entries."),l().createElement(k.A,null,l().createElement(g.A,{color:"danger",onClick:function(){a&&(A("deleting"),fetch("/plugins/signalk-logbook/logs/".concat(a),{method:"DELETE"}).then(function(t){t.ok?(A("success"),o(n.filter(function(e){return e!==a})),c(null),m([]),e.onDataChange&&e.onDataChange()):A("error")}).catch(function(e){console.error("Error deleting day:",e),A("error")}))},disabled:"deleting"===h},"deleting"===h?"Deleting...":"Delete"),l().createElement(g.A,{color:"secondary",onClick:function(){return y(!1)}},"Cancel"))))};function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach(function(t){fe(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function fe(e,t,n){return(t=function(e){var t=function(e){if("object"!=se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==se(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function pe(e){if(!e||!e.latitude||!e.longitude)return"N/A";var t=Math.abs(e.latitude),n=Math.floor(t),r=(60*(t-n)).toFixed(3),l=e.latitude>=0?"N":"S",o=Math.abs(e.longitude),i=Math.floor(o),a=(60*(o-i)).toFixed(3),c=e.longitude>=0?"E":"W";return"".concat(n,"° ").concat(r,"' ").concat(l," ").concat(i.toString().padStart(3,"0"),"° ").concat(a,"' ").concat(c)}function ve(e){return e||0===e?e.toFixed(1):"0.0"}function be(){var e,t,n,a,c,u=ge((0,r.useState)([]),2),s=u[0],m=u[1],d=ge((0,r.useState)(null),2),f=d[0],g=d[1],y=ge((0,r.useState)([]),2),p=y[0],v=y[1],b=ge((0,r.useState)(!0),2),E=b[0],h=b[1];(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){m(e.sort().reverse()),h(!1)}).catch(function(e){console.error("Error fetching days:",e),h(!1)})},[]);var A,S;return E?l().createElement("div",null,"Loading..."):l().createElement("div",null,l().createElement(re.A,null,l().createElement(le.A,null,l().createElement("h4",null,"Reports - Logbook Analysis")),l().createElement(oe.A,null,l().createElement(o.A,null,l().createElement(i.A,{md:4},l().createElement("h5",null,"Available Days"),l().createElement("p",null,"Select a day to view reports"),l().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},s.map(function(e){return l().createElement(re.A,{key:e,className:"mb-2 ".concat(f===e?"border-primary":""),style:{cursor:"pointer"},onClick:function(){return function(e){g(e),fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()}).then(function(e){var t=function(e){if(!e||0===e.length)return[];var t=0,n=0;return e.map(function(r,l){var o,i,a,c,u,s=l>0?e[l-1]:null,m=0;return s&&r.position&&s.position&&(m=function(e,t){if(!(e&&t&&e.latitude&&e.longitude&&t.latitude&&t.longitude))return 0;var n=(t.latitude-e.latitude)*Math.PI/180,r=(t.longitude-e.longitude)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*3440.065}(s.position,r.position),t+=m,n+=m),de(de({},r),{},{time:new Date(r.datetime).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",timeZone:"UTC"}),formattedPosition:pe(r.position),course:r.course||r.heading||0,sog:(null===(o=r.speed)||void 0===o?void 0:o.sog)||r.speedOverGround||0,segmentDistance:m,cumulativeMotorDistance:t,cumulativeLogDistance:n,barometer:(null===(i=r.observations)||void 0===i?void 0:i.barometer)||r.barometer||"---",windSpeed:(null===(a=r.wind)||void 0===a?void 0:a.speed)||"---",windDirection:(null===(c=r.wind)||void 0===c?void 0:c.direction)||"---",seaState:(null===(u=r.observations)||void 0===u?void 0:u.seaState)||"---"})})}(e);v(t)}).catch(function(e){console.error("Error fetching entries:",e),v([])})}(e)}},l().createElement(oe.A,{className:"py-2"},l().createElement("div",{style:{fontWeight:"bold"}},e),l().createElement("small",{className:"text-muted"},"Click to view report")))}))),l().createElement(i.A,{md:8},f?l().createElement("div",null,l().createElement("div",{style:{marginBottom:"20px",borderBottom:"2px solid #000",paddingBottom:"10px"}},l().createElement("h4",{style:{margin:"0",fontWeight:"bold"}},"DATE: ",new Date(f).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),p.length>0&&l().createElement(l().Fragment,null,l().createElement("div",{style:{marginTop:"5px"}},l().createElement("strong",null,"FROM:")," ",(null===(e=p[0])||void 0===e?void 0:e.formattedPosition)||"N/A"),l().createElement("div",null,l().createElement("strong",null,"TO:")," ",(null===(t=p[p.length-1])||void 0===t?void 0:t.formattedPosition)||"N/A"))),p.length>0?l().createElement("div",{style:{overflowX:"auto"}},l().createElement(B.A,{bordered:!0,size:"sm",style:{fontSize:"11px",marginBottom:"20px"}},l().createElement("thead",{style:{backgroundColor:"#f8f9fa"}},l().createElement("tr",null,l().createElement("th",{style:{textAlign:"center",minWidth:"60px"}},"Kellaaeg",l().createElement("br",null),"Time"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Tuule suund ja",l().createElement("br",null),"tugevus / Wind",l().createElement("br",null),"direction and",l().createElement("br",null),"velo city"),l().createElement("th",{style:{textAlign:"center",minWidth:"60px"}},"Lainetus",l().createElement("br",null),"Sea state"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Ilmastik ja",l().createElement("br",null),"nähtavus",l().createElement("br",null),"Weather and",l().createElement("br",null),"visibility"),l().createElement("th",{style:{textAlign:"center",minWidth:"60px"}},"Õhurõhk",l().createElement("br",null),"Air pressure"),l().createElement("th",{style:{textAlign:"center",minWidth:"60px"}},"Õhu temper.",l().createElement("br",null),"Air temper"),l().createElement("th",{style:{textAlign:"center",minWidth:"60px"}},"Vee temper.",l().createElement("br",null),"Water temper"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Lastiruumid",l().createElement("br",null),"Cargo holds"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Pilsivee võrra",l().createElement("br",null),"Bilge water",l().createElement("br",null),"level"))),l().createElement("tbody",null,[1,2,3,4,5,6].map(function(e){var t=p[e-1];return l().createElement("tr",{key:e},l().createElement("td",{style:{textAlign:"center"}},t?t.time:""),l().createElement("td",{style:{textAlign:"center"}},t&&t.wind?"".concat(Math.round(t.wind.direction||0),"° ").concat(ve(t.wind.speed||0),"kn"):""),l().createElement("td",{style:{textAlign:"center"}},t&&t.observations&&t.observations.seaState?t.observations.seaState:""),l().createElement("td",{style:{textAlign:"center"}},t&&t.observations?t.observations.visibility?"☀️ Vis: ".concat(t.observations.visibility):"☀️ Good":""),l().createElement("td",{style:{textAlign:"center"}},t&&t.observations&&t.observations.barometer?"".concat(t.observations.barometer," mBar"):""),l().createElement("td",{style:{textAlign:"center"}},t&&t.observations&&t.observations.airTemperature?"".concat(t.observations.airTemperature,"°C"):""),l().createElement("td",{style:{textAlign:"center"}},t&&t.observations&&t.observations.waterTemperature?"".concat(t.observations.waterTemperature,"°C"):""),l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",backgroundColor:"#f8f9fa"}},e,"."),l().createElement("td",{style:{textAlign:"center"}},t&&t.observations&&t.observations.bilgeWater?"".concat(t.observations.bilgeWater,"cm"):""))}))),l().createElement(B.A,{bordered:!0,size:"sm",style:{fontSize:"11px",marginBottom:"20px"}},l().createElement("thead",{style:{backgroundColor:"#f8f9fa"}},l().createElement("tr",null,l().createElement("th",{style:{textAlign:"center",minWidth:"60px"}},"Kellaaeg",l().createElement("br",null),"Time"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Läbisõit",l().createElement("br",null),"Passage"),l().createElement("th",{style:{textAlign:"center",minWidth:"120px"}},"Vahitüürimees",l().createElement("br",null),"OOW (Officer of the watch)"),l().createElement("th",{style:{textAlign:"center",minWidth:"120px"}},"Vahimadrused",l().createElement("br",null),"Seaman of the watch")),l().createElement("tr",null,l().createElement("th",{style:{textAlign:"center",backgroundColor:"#f8f9fa"}},"9"),l().createElement("th",{style:{textAlign:"center",backgroundColor:"#f8f9fa"}},"10"),l().createElement("th",{style:{textAlign:"center",backgroundColor:"#f8f9fa"}},"11"),l().createElement("th",{style:{textAlign:"center",backgroundColor:"#f8f9fa"}},"12"))),l().createElement("tbody",null,["00:00","06:00","12:00","18:00",""].map(function(e,t){var n=p.filter(function(t){if(!e)return!1;var n=new Date(t.datetime).getHours(),r=parseInt(e.split(":")[0]);return Math.abs(n-r)<=1}),r=n.length>0?n[n.length-1]:null,o=r?ve(r.cumulativeMotorDistance||0):"";return l().createElement("tr",{key:t,style:{height:"30px"}},l().createElement("td",{style:{textAlign:"center"}},e),l().createElement("td",{style:{textAlign:"center"}},o),l().createElement("td",{style:{textAlign:"center"}},(null==r?void 0:r.author)||""),l().createElement("td",{style:{textAlign:"center"}},(null==r?void 0:r.crew)||(null==r?void 0:r.author)||""))}))),l().createElement(B.A,{bordered:!0,size:"sm",style:{fontSize:"11px",marginBottom:"20px"}},l().createElement("tbody",null,l().createElement("tr",null,l().createElement("td",{style:{textAlign:"left",fontWeight:"bold",backgroundColor:"#f8f9fa",padding:"5px"}},"Ööpäevas",l().createElement("br",null),"During 24 HRS"),l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",minWidth:"60px"}},ve((null===(n=p[p.length-1])||void 0===n?void 0:n.cumulativeMotorDistance)||0)),l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",backgroundColor:"#f8f9fa",minWidth:"40px"}},"13"),l().createElement("td",{style:{textAlign:"center",minWidth:"200px"}},"Navigatsioonitulede sisselülitamine",l().createElement("br",null),l().createElement("em",null,"Switching on navigation lights")),l().createElement("td",{style:{textAlign:"center",minWidth:"80px"}},(S=p.find(function(e){return e.text&&e.text.toLowerCase().includes("navigation")||e.text&&e.text.toLowerCase().includes("light")}))?S.time:"--:--")),l().createElement("tr",null,l().createElement("td",{style:{textAlign:"left",fontWeight:"bold",backgroundColor:"#f8f9fa",padding:"5px"}},"Reisi algusest/From",l().createElement("br",null),"the commencement",l().createElement("br",null),"of the voyage"),l().createElement("td",{style:{textAlign:"center",fontWeight:"bold"}},ve((null===(a=p[p.length-1])||void 0===a?void 0:a.cumulativeMotorDistance)||0)),l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",backgroundColor:"#f8f9fa"}}),l().createElement("td",{style:{textAlign:"center"}},"Navigatsioonitulede väljalülitamine",l().createElement("br",null),l().createElement("em",null,"Switching off navigation lights")),l().createElement("td",{style:{textAlign:"center"}},(A=p.find(function(e){return e.text&&e.text.toLowerCase().includes("light")&&e.text.toLowerCase().includes("off")||e.text&&e.text.toLowerCase().includes("kustut")}))?A.time:"-")))),l().createElement(B.A,{bordered:!0,size:"sm",style:{fontSize:"11px",marginBottom:"0"}},l().createElement("tbody",null,l().createElement("tr",null,l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",backgroundColor:"#f8f9fa",minWidth:"40px"}},"14"),l().createElement("td",{colSpan:5,style:{textAlign:"center",padding:"10px",fontWeight:"bold"}},"Laeva varustus / Ship's supplies")))),l().createElement(B.A,{bordered:!0,size:"sm",style:{fontSize:"11px",marginBottom:"0"}},l().createElement("thead",{style:{backgroundColor:"#f8f9fa"}},l().createElement("tr",null,l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Diislikütus / Diesel fuel"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Raskes kütus / Heavy fuel"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Mage vesi / Fresh water"))),l().createElement("tbody",null,l().createElement("tr",null,l().createElement("td",{style:{textAlign:"center",padding:"5px"}},l().createElement("div",{style:{fontWeight:"bold",marginBottom:"5px"}},"Kütuseid ööpäevas",l().createElement("br",null),"Consumption per day"),l().createElement("div",{style:{marginBottom:"5px"}}),l().createElement("div",null,"Jääk",l().createElement("br",null),"Remainder"),l().createElement("div",null)),l().createElement("td",{style:{textAlign:"center",padding:"5px"}},l().createElement("div",{style:{fontWeight:"bold",marginBottom:"5px"}},"Kütuseid ööpäevas",l().createElement("br",null),"Consumption per day"),l().createElement("div",{style:{marginBottom:"5px"}}),l().createElement("div",null,"Jääk",l().createElement("br",null),"Remainder"),l().createElement("div",null)),l().createElement("td",{style:{textAlign:"center",padding:"5px"}},l().createElement("div",{style:{fontWeight:"bold",marginBottom:"5px"}},"Kütuseid ööpäevas",l().createElement("br",null),"Consumption per day"),l().createElement("div",{style:{marginBottom:"5px"}}),l().createElement("div",null,"Jääk",l().createElement("br",null),"Remainder"),l().createElement("div",null))))),l().createElement(B.A,{bordered:!0,size:"sm",style:{fontSize:"10px",marginTop:"10px"}},l().createElement("thead",{style:{backgroundColor:"#f8f9fa"}},l().createElement("tr",null,l().createElement("th",{style:{textAlign:"center",minWidth:"60px"}},"Tankid / Tanks"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].map(function(e){return l().createElement("th",{key:e,style:{textAlign:"center",minWidth:"25px"}},e)}))),l().createElement("tbody",null,l().createElement("tr",null,l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",backgroundColor:"#f8f9fa"}},"Ballast vesi",l().createElement("br",null),"Ballast water"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].map(function(e){return l().createElement("td",{key:e,style:{textAlign:"center",height:"30px"}})})),l().createElement("tr",null,l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",backgroundColor:"#f8f9fa"}},"Kütus",l().createElement("br",null),"Fuel"),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].map(function(e){return l().createElement("td",{key:e,style:{textAlign:"center",height:"30px"}})})))),l().createElement("div",{style:{marginTop:"30px",pageBreakBefore:"always"}},l().createElement("div",{style:{marginBottom:"20px",borderBottom:"2px solid #000",paddingBottom:"10px"}},l().createElement("h4",{style:{margin:"0",fontWeight:"bold",textAlign:"center"}},"Logiraamatu kirjed / Logbook Timeline"),l().createElement("div",{style:{textAlign:"center",marginTop:"5px",fontSize:"12px"}},l().createElement("strong",null,new Date(f).toLocaleDateString("et-EE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})))),l().createElement(B.A,{bordered:!0,size:"sm",style:{fontSize:"11px",marginBottom:"0"}},l().createElement("thead",{style:{backgroundColor:"#f8f9fa"}},l().createElement("tr",null,l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Kellaaeg",l().createElement("br",null),"Time"),l().createElement("th",{style:{textAlign:"left",minWidth:"400px"}},"Märkused ja tegevused",l().createElement("br",null),"Remarks and Activities"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Autor",l().createElement("br",null),"Author"),l().createElement("th",{style:{textAlign:"center",minWidth:"80px"}},"Kategooria",l().createElement("br",null),"Category"))),l().createElement("tbody",null,p.map(function(e,t){return l().createElement("tr",{key:t,style:{backgroundColor:"Automatic"===e.author?"#f8f9fa":"white",borderLeft:"Automatic"===e.author?"3px solid #007bff":"3px solid #28a745"}},l().createElement("td",{style:{textAlign:"center",fontWeight:"bold",verticalAlign:"top",padding:"8px"}},e.time),l().createElement("td",{style:{textAlign:"left",padding:"8px",lineHeight:"1.4"}},l().createElement("div",{style:{marginBottom:"5px"}},l().createElement("strong",null,e.text||"Automaatne kirje")),e.position&&l().createElement("div",{style:{fontSize:"10px",color:"#666",marginBottom:"3px"}},"📍 ",e.formattedPosition),e.wind&&e.wind.speed&&l().createElement("div",{style:{fontSize:"10px",color:"#666",marginBottom:"3px"}},"🌬️ Tuul: ",Math.round(e.wind.direction),"° ",ve(e.wind.speed),"kn"),e.speed&&e.speed.sog&&l().createElement("div",{style:{fontSize:"10px",color:"#666",marginBottom:"3px"}},"⚡ Kiirus: ",ve(e.speed.sog),"kn"),e.course&&l().createElement("div",{style:{fontSize:"10px",color:"#666",marginBottom:"3px"}},"🧭 Kurss: ",(n=e.course)||0===n?"".concat(Math.round(n).toString().padStart(3,"0"),"°"):"---","°"),e.segmentDistance>0&&l().createElement("div",{style:{fontSize:"10px",color:"#666"}},"📏 Vahemaa: ",ve(e.segmentDistance),"NM (Kokku: ",ve(e.cumulativeMotorDistance),"NM)")),l().createElement("td",{style:{textAlign:"center",verticalAlign:"top",padding:"8px",fontSize:"10px"}},e.author),l().createElement("td",{style:{textAlign:"center",verticalAlign:"top",padding:"8px"}},"navigation"===e.category?"⚓":"engine"===e.category?"🔧":"radio"===e.category?"📡":"maintenance"===e.category?"🔨":"📝"));var n}))),l().createElement("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"5px"}},l().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},l().createElement("div",null,l().createElement("strong",null,"Päeva kokkuvõte / Daily Summary:"),l().createElement("div",{style:{fontSize:"12px",marginTop:"5px"}},"Kirjeid kokku: ",p.length," | Automaatseid: ",p.filter(function(e){return"Automatic"===e.author}).length," | Käsitsi: ",p.filter(function(e){return"Automatic"!==e.author}).length)),l().createElement("div",{style:{textAlign:"right"}},l().createElement("div",null,l().createElement("strong",null,"Läbitud vahemaa:")," ",ve((null===(c=p[p.length-1])||void 0===c?void 0:c.cumulativeMotorDistance)||0)," NM"),l().createElement("div",{style:{fontSize:"12px",marginTop:"5px"}},l().createElement("strong",null,"Kapten / Master:")," ________________")))))):l().createElement("p",null,"No entries found for this day.")):l().createElement("div",{style:{textAlign:"center",padding:"50px",color:"#6c757d"}},l().createElement("h5",null,"Select a day from the left panel to view detailed report data.")))))))}var Ee=n(9575),he=n(8332),Ae=n(9654),Se=n(2113),xe=n(8227),we=n(1909);function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach(function(t){je(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function je(e,t,n){return(t=function(e){var t=function(e){if("object"!=Ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ne(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Te(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Te(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Pe(e){return null==e||isNaN(e)?null:Number((1.94384*e).toFixed(1))}const De=function(e){var t,n,o,i,a,c,u,s,m,d,f,y,p=e.entry&&void 0!==e.entry.ago,h=Ce((0,r.useState)({}),2),A=h[0],O=h[1],j=Ce((0,r.useState)(function(){return p?Oe(Oe({text:"",category:e.categories[0]||"",ago:0,observations:{}},e.entry),{},{position:e.entry&&e.entry.position?Oe({},e.entry.position):{latitude:52.51117,longitude:13.19329,source:"GPS"}}):Oe({},e.entry)}),2),C=j[0],T=j[1];(0,r.useEffect)(function(){T(p?Oe(Oe({text:"",category:e.categories[0]||"",ago:0,observations:{}},e.entry),{},{position:e.entry&&e.entry.position?Oe({},e.entry.position):{latitude:52.51117,longitude:13.19329,source:"GPS"}}):Oe({},e.entry))},[e.entry]),(0,r.useEffect)(function(){fetch("".concat(window.location.origin,"/signalk/v1/api/vessels/self"),{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){var t,n,r,l,o,i,a,c,u,s,m,d,f,g,y,v,b,E,h=(e&&e.environment||{}).wind||{},A=null==e||null===(t=e.environment)||void 0===t||null===(t=t.outside)||void 0===t||null===(t=t.pressure)||void 0===t?void 0:t.value,S=null==e||null===(n=e.environment)||void 0===n||null===(n=n.outside)||void 0===n||null===(n=n.visibility)||void 0===n?void 0:n.value,x=null!==(r=null!==(l=null===(o=h.speedTrue)||void 0===o?void 0:o.value)&&void 0!==l?l:null===(i=h.speedApparent)||void 0===i?void 0:i.value)&&void 0!==r?r:null===(a=h.speedOverGround)||void 0===a?void 0:a.value,w=null!==(c=null===(u=h.directionTrue)||void 0===u?void 0:u.value)&&void 0!==c?c:null===(s=h.directionMagnetic)||void 0===s?void 0:s.value,N=Pe(x),k={windSpeed:N,windDirection:null!=w?Math.round((180*Number(w)/Math.PI+360)%360):null,barometer:null!=A?Number(A)>2e3?Number((Number(A)/100).toFixed(2)):Number(Number(A).toFixed(2)):null,sog:Pe(null==e||null===(m=e.navigation)||void 0===m||null===(m=m.speedOverGround)||void 0===m?void 0:m.value),stw:Pe(null==e||null===(d=e.navigation)||void 0===d||null===(d=d.speedThroughWater)||void 0===d?void 0:d.value),cog:null!=(null==e||null===(f=e.navigation)||void 0===f||null===(f=f.courseOverGroundTrue)||void 0===f?void 0:f.value)?Math.round((180*Number(e.navigation.courseOverGroundTrue.value)/Math.PI+360)%360):null,hdt:null!=(null==e||null===(g=e.navigation)||void 0===g||null===(g=g.headingTrue)||void 0===g?void 0:g.value)?Math.round((180*Number(e.navigation.headingTrue.value)/Math.PI+360)%360):null,depth:null!==(y=null==e||null===(v=e.environment)||void 0===v||null===(v=v.depth)||void 0===v||null===(v=v.belowTransducer)||void 0===v?void 0:v.value)&&void 0!==y?y:null,waterTemp:null!=(null==e||null===(b=e.environment)||void 0===b||null===(b=b.water)||void 0===b||null===(b=b.temperature)||void 0===b?void 0:b.value)?Number(e.environment.water.temperature.value-273.15).toFixed(1):null,logNm:null!=(null==e||null===(E=e.navigation)||void 0===E||null===(E=E.log)||void 0===E?void 0:E.value)?Number((Number(e.navigation.log.value)/1852).toFixed(1)):null};O(k),p&&T(function(t){var n,r,l=Oe({},t);if((null!=N||null!=w)&&(l.wind=Oe({},l.wind||{}),null!=N&&(l.wind.speed=N),null!=w)){var o=Math.round((180*Number(w)/Math.PI+360)%360);l.wind.direction=o}l.observations=Oe({},l.observations||{}),null==l.observations.seaState&&null!=N&&(l.observations.seaState=function(e){if(null==e||isNaN(e))return null;var t=Number(e);return t<=1?0:t<=3?1:t<=6?2:t<=10?3:t<=16?4:t<=21?5:t<=27?6:t<=33?7:t<=40?8:t<=47?9:t<=55?10:t<=63?11:12}(N));var i,a=null==(i=S)||isNaN(i)?null:i<45?1:i<180?2:i<360?3:i<926?4:i<1852?5:i<3704?6:i<9260?7:i<18520?8:i<55560?9:10;if(null==l.observations.visibility&&null!=a&&(l.observations.visibility=a),null!=A){var c=Number(A);l.barometer=Number(c>2e3?(c/100).toFixed(2):c.toFixed(2))}var u=null!=(null==e||null===(n=e.navigation)||void 0===n||null===(n=n.log)||void 0===n?void 0:n.value)?e.navigation.log.value:null==e||null===(r=e.navigation)||void 0===r||null===(r=r.trip)||void 0===r||null===(r=r.log)||void 0===r?void 0:r.value;return null!=u&&(l.log=Number((Number(u)/1852).toFixed(1))),l})})},[p,e.entry]),(0,r.useEffect)(function(){p&&console.log("Add entry: props.entry.position =",e.entry&&e.entry.position)},[p,e.entry]);var P=[],D=C;if(e.allEntries&&C&&!p){for(var M=C;M.amends;){var I=e.allEntries.find(function(e){return e.datetime===M.amends});if(!I)break;M=I}for(var W=[M],L=e.allEntries.find(function(e){return e.amends===M.datetime});L;)W.push(L),L=e.allEntries.find(function(e){return e.amends===L.datetime});(P=[].concat(W).reverse()).length>1&&(D=P[P.length-1])}var B=[];function R(e){var t=e.target,n=t.name,r=t.value,l=t.type;T(function(e){var t=Oe({},e);switch(n){case"seaState":case"cloudCoverage":case"visibility":t.observations=Oe({},t.observations);var o=parseInt(r,10);-1===o?delete t.observations[n]:t.observations[n]=o;break;case"latitude":case"longitude":case"source":t.position=Oe({},t.position),t.position[n]="source"===n?r:Number(r);break;case"ago":t.ago=parseInt(r,10);break;default:t[n]="number"===l?Number(r):r}return t})}P.length>1&&(B=P.slice(0,-1)),e.allEntries&&D&&!p&&e.allEntries.some(function(e){return e.amends===D.datetime}),e.allEntries&&D&&!p&&e.allEntries.filter(function(e){return e.datetime!==D.datetime}).sort(function(e,t){return new Date(t.datetime)-new Date(e.datetime)}).slice(0,5);var z=Ce((0,r.useState)(""),2),G=z[0],F=z[1];function U(e){return!!p||!function(e){return e&&("Automatic"===e.author||"Automatic log entry"===e.text)}(D)}return p&&C.ago&&Number(C.ago),p&&(!C.ago||Number(C.ago)),l().createElement(v.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},p?"New entry":"Log entry ".concat(new Date(D.date||D.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})," by ").concat(D.author||"auto")),l().createElement(E.A,null,l().createElement("div",{className:"d-flex justify-content-start align-items-center mb-3"},e.categories.map(function(e){return l().createElement(g.A,{key:e,color:C.category===e?"primary":"outline-primary",size:"sm",className:"me-2",onClick:function(){return T(function(t){return Oe(Oe({},t),{},{category:e})})}},e.charAt(0).toUpperCase()+e.slice(1))})),l().createElement(S.A,null,l().createElement(x.A,null,l().createElement(w.A,{for:"text"},"Remarks"),B.length>0&&l().createElement("div",{style:{border:"1px solid #eee",borderRadius:4,padding:8,background:"#fafbfc",marginBottom:8}},l().createElement("div",{style:{fontWeight:"bold",marginBottom:4}},"Previous entries"),B.map(function(t){return l().createElement("div",{key:t.datetime,style:{marginBottom:6}},l().createElement("div",{style:{fontSize:"0.9em",color:"#888"}},new Date(t.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})),l().createElement("div",{style:{fontWeight:"bold"}},t.text))})),l().createElement(N.A,{id:"text",name:"text",type:"textarea",placeholder:"Tell what happened",value:C.text||"",onChange:R,disabled:!U()})),l().createElement("div",{style:{borderTop:"1px solid #eee",marginTop:12,paddingTop:12}},l().createElement("div",{style:{fontWeight:"bold",marginBottom:8}},"Live readings"),l().createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8}},l().createElement("div",null,"Wind: ",null!=A.windSpeed?"".concat(A.windSpeed," kt"):"n/a"," ",null!=A.windDirection?"(".concat(A.windDirection,"°)"):""),l().createElement("div",null,"Log: ",null!=A.logNm?"".concat(A.logNm," NM"):"n/a"),l().createElement("div",null,"SOG/STW: ",null!=A.sog?"".concat(A.sog," /"):""," ",null!=A.stw?"".concat(A.stw," kt"):""),l().createElement("div",null,"COG/HDT: ",null!=A.cog?"".concat(A.cog,"° /"):""," ",null!=A.hdt?"".concat(A.hdt,"°"):""),l().createElement("div",null,"Depth: ",null!=A.depth?"".concat(A.depth," m"):"n/a"),l().createElement("div",null,"Water temp: ",null!=A.waterTemp?"".concat(A.waterTemp," °C"):"n/a"))),P.length>1&&l().createElement(x.A,null,l().createElement(w.A,null,"Previous versions"),l().createElement("div",{style:{border:"1px solid #eee",borderRadius:4,padding:8,background:"#fafbfc"}},P.slice(0,-1).map(function(t){return l().createElement("div",{key:t.datetime,style:{marginBottom:6}},l().createElement("div",{style:{fontSize:"0.9em",color:"#888"}},new Date(t.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})),l().createElement("div",{style:{fontWeight:"bold"}},t.text))}))),p&&l().createElement(x.A,null,l().createElement(w.A,{for:"ago"},"This happened"),l().createElement(N.A,{id:"ago",name:"ago",type:"select",value:C.ago,onChange:R,disabled:!U()},[0,5,10,15].map(function(e){return l().createElement("option",{key:e,value:e},e," minutes ago")}))),"radio"===C.category&&l().createElement(x.A,null,l().createElement(w.A,{for:"vhf"},"VHF channel"),l().createElement(N.A,{id:"vhf",name:"vhf",placeholder:"16",value:C.vhf||"",onChange:R,disabled:!U()})),"navigation"===C.category&&l().createElement(Ee.A,{open:G,toggle:function(e){F(G===e?"":e)}},l().createElement(he.A,null,l().createElement(Ae.A,{targetId:"observations"},"Observations"),l().createElement(Se.A,{accordionId:"observations"},l().createElement(x.A,null,l().createElement(w.A,{for:"seaState"},"Sea state"),l().createElement(N.A,{id:"seaState",name:"seaState",type:"select",value:null!==(t=null===(n=C.observations)||void 0===n?void 0:n.seaState)&&void 0!==t?t:-1,onChange:R,disabled:!U()},["","Glassy calm (0m)","Rippled calm (0-0.1m)","Smooth (0.1-0.5m)","Slight (0.5-1.25m)","Moderate (1.25-2.5m)","Rough (2.5-4m)","Very rough (4-6m)","High (6-9m)","Very high (9-14m)","Phenomenal (14m+)"].map(function(e,t){return l().createElement("option",{key:t,value:t-1},e)}))),l().createElement(x.A,null,l().createElement(w.A,{for:"cloudCoverage"},"Cloud coverage"),l().createElement(xe.A,null,l().createElement(N.A,{id:"cloudCoverage",name:"cloudCoverage",type:"range",min:"-1",max:"8",step:"1",value:null!==(o=null===(i=C.observations)||void 0===i?void 0:i.cloudCoverage)&&void 0!==o?o:-1,onChange:R,disabled:!U()}),l().createElement(we.A,null,C.observations&&C.observations.cloudCoverage>-1?"".concat(C.observations.cloudCoverage,"/8"):"n/a"))),l().createElement(x.A,null,l().createElement(w.A,{for:"visibility"},"Visibility"),l().createElement(N.A,{id:"visibility",name:"visibility",type:"select",value:null!==(a=null===(c=C.observations)||void 0===c?void 0:c.visibility)&&void 0!==a?a:-1,onChange:R,disabled:!U()},["","Dense fog (<45m)","Thick fog (<180m)","Fog (<360m)","Moderate fog (<0.5NM)","Thin fog (<1NM)","Poor visibility (<2NM)","Moderate visibility (<5NM)","Good visibility (<10NM)","Very good visibility (<30NM)","Excellent visibility (>30NM)"].map(function(e,t){return l().createElement("option",{key:t,value:t-1},e)}))))),l().createElement(he.A,null,l().createElement(Ae.A,{targetId:"position"},"Position"),l().createElement(Se.A,{accordionId:"position"},l().createElement(x.A,null,l().createElement(w.A,{for:"latitude"},"Latitude"),l().createElement(N.A,{id:"latitude",name:"latitude",type:"number",placeholder:"52.51117",max:"90",min:"-90",step:"0.00001",value:null!==(u=null===(s=C.position)||void 0===s?void 0:s.latitude)&&void 0!==u?u:"",onChange:R,disabled:!1})),l().createElement(x.A,null,l().createElement(w.A,{for:"longitude"},"Longitude"),l().createElement(N.A,{id:"longitude",name:"longitude",type:"number",placeholder:"13.19329",max:"180",min:"-180",step:"0.00001",value:null!==(m=null===(d=C.position)||void 0===d?void 0:d.longitude)&&void 0!==m?m:"",onChange:R,disabled:!1})),l().createElement(x.A,null,l().createElement(w.A,{for:"source"},"Fix type"),l().createElement(N.A,{id:"source",name:"source",type:"select",value:null!==(f=null===(y=C.position)||void 0===y?void 0:y.source)&&void 0!==f?f:"",onChange:R,disabled:!1},["GPS","GNSS","Visual","Radar","Celestial","DR"].map(function(e){return l().createElement("option",{key:e,value:e},e)})))))))),l().createElement(k.A,null,l().createElement(g.A,{color:"primary",onClick:function(){if(C.text&&""!==C.text.trim()){var t=Oe({},C);if("navigation"!==t.category)delete t.position;else{var n,r,l,o=null===(n=t.position)||void 0===n?void 0:n.latitude,i=null===(r=t.position)||void 0===r?void 0:r.longitude,a=null===(l=t.position)||void 0===l?void 0:l.source;if(void 0!==a&&""!==a||!document.getElementById("source")||(a=document.getElementById("source").value),null==o||""===o||null==i||""===i)return void alert("Palun sisesta asukoht (latitude ja longitude)!");if(t.position={latitude:parseFloat(o),longitude:parseFloat(i),source:a||"GPS"},isNaN(t.position.latitude)||isNaN(t.position.longitude))return void alert("Latitude ja longitude peavad olema numbrid!")}t.datetime||(t.datetime=(new Date).toISOString()),e.save(t)}else alert("Logikirje tekst ('Remarks') on kohustuslik!")}},"Save")," ",l().createElement(g.A,{color:"secondary",onClick:e.cancel},"Cancel")))};var Me=n(8354);const Ie=function(e){var t=e.entry;return l().createElement("div",null,l().createElement("p",null,t.text," ",t.category&&l().createElement(Me.A,{color:"secondary",pill:!0},"#",t.category)," ",t.end&&l().createElement(Me.A,{color:"secondary",pill:!0},"#trip-end")),l().createElement(B.A,{borderless:!0,striped:!0,size:"sm"},l().createElement("tbody",null,t.point&&l().createElement("tr",null,l().createElement("th",null,"Position"),l().createElement("td",null,t.point.toString()," ",t.position.source||"GPS")),t.speed&&!Number.isNaN(Number(t.speed.sog))&&l().createElement("tr",null,l().createElement("th",null,"Speed"),l().createElement("td",null,t.speed.sog,"kt")),!Number.isNaN(Number(t.course))&&l().createElement("tr",null,l().createElement("th",null,"Course"),l().createElement("td",null,t.course,"°")),!Number.isNaN(Number(t.heading))&&l().createElement("tr",null,l().createElement("th",null,"Heading"),l().createElement("td",null,t.heading,"°")),t.wind&&l().createElement("tr",null,l().createElement("th",null,"Wind"),l().createElement("td",null,Number.isNaN(Number(t.wind.speed))?"":"".concat(t.wind.speed,"kt "),Number.isNaN(Number(t.wind.direction))?"":"".concat(t.wind.direction,"°"))),t.observations&&!Number.isNaN(Number(t.observations.seaState))&&l().createElement("tr",null,l().createElement("th",null,"Sea"),l().createElement("td",null,t.observations.seaState+1,": ",["","Glassy calm (0m)","Rippled calm (0-0.1m)","Smooth (0.1-0.5m)","Slight (0.5-1.25m)","Moderate (1.25-2.5m)","Rough (2.5-4m)","Very rough (4-6m)","High (6-9m)","Very high (9-14m)","Phenomenal (14m+)"][t.observations.seaState+1])),t.observations&&!Number.isNaN(Number(t.observations.cloudCoverage))&&l().createElement("tr",null,l().createElement("th",null,"Clouds"),l().createElement("td",null,["◯","⌽","◔","◔","◑","◕","◕","⬤"][t.observations.cloudCoverage]," ",t.observations.cloudCoverage,"/8")),t.observations&&!Number.isNaN(Number(t.observations.visibility))&&l().createElement("tr",null,l().createElement("th",null,"Visibility"),l().createElement("td",null,t.observations.visibility+1,": ",["","Dense fog (<45m)","Thick fog (<180m)","Fog (<360m)","Moderate fog (<0.5NM)","Thin fog (<1NM)","Poor visibility (<2NM)","Moderate visibility (<5NM)","Good visibility (<10NM)","Very good visibility (<30NM)","Excellent visibility (>30NM)"][t.observations.visibility+1])),"engine"===t.category&&t.engine&&l().createElement("tr",null,l().createElement("th",null,"Engine"),l().createElement("td",null,Number.isNaN(Number(t.engine.hours))?"":"".concat(t.engine.hours,"h "))),"radio"===t.category&&t.vhf&&l().createElement("tr",null,l().createElement("th",null,"VHF channel"),l().createElement("td",null,Number.isNaN(Number(t.vhf))?"":"".concat(t.vhf))))))},We=function(e){var t=e.entry;return l().createElement(v.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},"Log entry ",t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})," by ",t.author||"auto"),l().createElement(E.A,null,l().createElement(Ie,{entry:t})),l().createElement(k.A,null,l().createElement(g.A,{color:"primary",onClick:function(){return e.editEntry(t)}},"Edit")," ",l().createElement(g.A,{color:"secondary",onClick:e.cancel},"Close")))};function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach(function(t){ze(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ze(e,t,n){return(t=function(e){var t=function(e){if("object"!=Le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Le(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,i,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Fe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Fe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ue=["navigation","engine","radio","maintenance"];const Ze=function(e){var t=Ge((0,r.useState)({entries:[]}),2),n=t[0],d=t[1],f=Ge((0,r.useState)("book"),2),g=f[0],y=f[1],p=Ge((0,r.useState)(7),2),v=p[0],b=p[1],E=Ge((0,r.useState)(null),2),h=E[0],A=E[1],S=Ge((0,r.useState)(null),2),x=S[0],w=S[1],N=Ge((0,r.useState)(null),2),k=N[0],O=N[1],j=Ge((0,r.useState)(!0),2),C=j[0],T=j[1],P=Ge((0,r.useState)("UTC"),2),D=P[0],M=P[1],I=Ge((0,r.useState)(""),2),W=I[0],B=I[1],R=Ge((0,r.useState)(null),2),z=(R[0],R[1]),G=Ge((0,r.useState)(null),2),F=G[0],U=G[1],Z=Ge((0,r.useState)(null),2),V=Z[0],H=Z[1],K=e.loginStatus.status;(0,r.useEffect)(function(){function e(){fetch("/signalk/v1/api/vessels/self/").then(function(e){return e.json()}).then(function(e){var t=null;e&&e.navigation&&e.navigation.position&&e.navigation.position.value&&(t=e.navigation.position.value),t&&"number"==typeof t.latitude&&"number"==typeof t.longitude&&U({latitude:t.latitude,longitude:t.longitude,source:"GPS"})})}e();var t=setInterval(e,5e3);return function(){return clearInterval(t)}},[]),(0,r.useEffect)(function(){if(C&&"notLoggedIn"!==K){var e=setInterval(function(){T(!0)},3e5);return fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){var t=new Date;t.setDate(t.getDate()-v);var n=e.filter(function(e){return e>=t.toISOString().substr(0,10)});Promise.all(n.map(function(e){return fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()})})).then(function(e){var t=[].concat.apply([],e);d({entries:t}),T(!1);var n=t.filter(function(e){return"navigation"===e.category&&e.position&&void 0!==e.position.latitude&&void 0!==e.position.longitude}).sort(function(e,t){return new Date(t.datetime)-new Date(e.datetime)})[0];n&&z(Re({},n.position))})}),function(){clearInterval(e)}}},[v,C,K]),(0,r.useEffect)(function(){fetch("/signalk/v1/applicationData/user/signalk-logbook/1.0").then(function(e){return e.json()}).then(function(e){e&&e.filter&&e.filter.daysToShow&&b(e.filter.daysToShow)})},[K]),(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/config").then(function(e){return e.json()}).then(function(e){e.configuration&&e.configuration.displayTimeZone&&M(e.configuration.displayTimeZone)})},[D]),(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/version").then(function(e){return e.json()}).then(function(e){e&&e.version&&B(e.version)})},[]),(0,r.useEffect)(function(){"loggedIn"===K&&fetch("/signalk/v1/auth/user").then(function(e){return e.json()}).then(function(e){H(e)}).catch(function(e){console.log("Could not fetch user info:",e)})},[K]);var J,$=function(){return(null==V?void 0:V.role)||(null==V?void 0:V.type)||"crew"},q=function(){var e=$().toLowerCase();return["admin","captain","chief officer","officer","engineer"].includes(e)},Y=function(){var e=$().toLowerCase();return["admin","captain","chief officer","officer","engineer"].includes(e)},X=function(){var e=$().toLowerCase();return["admin","captain","chief officer","engineer"].includes(e)};function Q(e){var t=Re({},e);delete t.signatureValid,delete t.audit,fetch("/plugins/signalk-logbook/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){O(null),T(!0)})}return"notLoggedIn"===e.loginStatus.status&&e.loginStatus.authenticationRequired?l().createElement(e.adminUI.Login,null):l().createElement("div",null,l().createElement(L,{adminUI:e.adminUI,loginStatus:e.loginStatus,daysToShow:v,setDaysToShow:b,setNeedsUpdate:T,userInfo:V}),l().createElement(o.A,null,h&&q()?l().createElement(De,{entry:h,cancel:function(){return A(null)},save:function(e){if(e.datetime&&!Number.isNaN(Date.parse(e.datetime))){var t=Re(Re({},e),{},{amends:e.datetime,datetime:(new Date).toISOString()});return delete t.point,delete t.date,delete t.signatureValid,void fetch("/plugins/signalk-logbook/logs/".concat(e.datetime.substr(0,10),"/").concat(e.datetime),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){A(null),T(!0)})}Q(e)},delete:(J=$().toLowerCase(),["admin","captain","chief officer"].includes(J)?function(e){var t=new Date(e.datetime).toISOString().substr(0,10);fetch("/plugins/signalk-logbook/logs/".concat(t,"/").concat(e.datetime),{method:"DELETE"}).then(function(){A(null),T(!0)})}:null),categories:Ue,displayTimeZone:D,allEntries:n.entries,userRole:$()}):null,x?l().createElement(We,{entry:x,editEntry:q()?A:null,cancel:function(){return w(null)},categories:Ue,displayTimeZone:D,userRole:$()}):null,k&&q()?l().createElement(De,{entry:k,cancel:function(){return O(null)},save:Q,categories:Ue,userRole:$()}):null,l().createElement(i.A,{className:"bg-light border"},l().createElement(a.A,{tabs:!0},l().createElement(c.A,null,l().createElement(u.A,{className:"book"===g?"active":"",onClick:function(){y("book"),e.adminUI.hideSideBar()}},"Logbook")),l().createElement(c.A,null,l().createElement(u.A,{className:"map"===g?"active":"",onClick:function(){return y("map")}},"Map")),X()&&l().createElement(c.A,null,l().createElement(u.A,{className:"service"===g?"active":"",onClick:function(){return y("service")}},"Service")),Y()&&l().createElement(c.A,null,l().createElement(u.A,{className:"reports"===g?"active":"",onClick:function(){return y("reports")}},"Reports"))),l().createElement(s.A,{activeTab:g},l().createElement(m.A,{tabId:"book"},"book"===g?l().createElement(_,{entries:n.entries,displayTimeZone:D,editEntry:q()?A:null,addEntry:q()?function(){return O({ago:0,category:"navigation",position:F})}:null,userRole:$(),canWrite:q()}):null),l().createElement(m.A,{tabId:"map"},"map"===g?l().createElement(ne,{entries:n.entries,editEntry:q()?A:null,viewEntry:w,userRole:$()}):null),X()&&l().createElement(m.A,{tabId:"service"},"service"===g?l().createElement(ue,{displayTimeZone:D,onDataChange:function(){return T(!0)},userRole:$()}):null),Y()&&l().createElement(m.A,{tabId:"reports"},"reports"===g?l().createElement(be,{displayTimeZone:D,userRole:$()}):null)))),l().createElement("div",{style:{fontFamily:"monospace",fontSize:"1.2em",color:"#007bff",display:"flex",justifyContent:"space-between",alignItems:"center"}},l().createElement("span",null,"Plugin version ",W||"..."," (live test)"),V&&l().createElement("span",{style:{fontSize:"0.9em",color:"#28a745"}},"👤 ",V.id||"Unknown"," (",$(),")")))}}}]);