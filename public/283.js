"use strict";(self.webpackChunksignalk_logbook=self.webpackChunksignalk_logbook||[]).push([[283],{3009:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Fe});var r=n(4823),o=n.n(r),l=n(9217),i=n(527),a=n(6664),u=n(7299),c=n(6980),s=n(3481),m=n(6644),d=n(4745),f=n(1883),v=n(949),y=n(1631),g=n.n(y),p=n(2706),b=n(3325),E=n(6768),h=n(26),S=n(7237),A=n(7587),N=n(4428),w=n(727),O=n(8337),k=n(8255);function j(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||P(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const D=function(e){var t=C((0,r.useState)(e.crewNames),2),n=t[0],l=t[1],i=C((0,r.useState)(n.includes(e.username)?"":e.username),2),a=i[0],u=i[1];function c(){if(a){var e=[].concat(j(n),[a]);l(e),u("")}}return o().createElement(p.A,{isOpen:!0,toggle:e.cancel},o().createElement(b.A,{toggle:e.cancel},"Crew"),o().createElement(E.A,null,o().createElement(h.A,{flush:!0},n.map(function(e,t){return o().createElement(S.A,{key:e},o().createElement(v.A,{onClick:function(){var e=j(n);e.splice(t,1),l(e)}},"X")," ",e)})),o().createElement(A.A,null,o().createElement(N.A,null,o().createElement(w.A,{for:"add"},"Add crew"),o().createElement(O.A,{id:"add",name:"add",placeholder:"bergie",color:"primary",value:a,onChange:function(e){var t=e.target.value;u(t)},onKeyPress:function(e){"Enter"===e.key&&(c(),e.stopPropagation(),e.preventDefault())}}),o().createElement(v.A,{onClick:c},"Add")))),o().createElement(k.A,null,o().createElement(v.A,{color:"primary",onClick:function(){return e.save(n)}},"Save")," ",o().createElement(v.A,{color:"secondary",onClick:e.cancel},"Cancel")))};function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const I=function(e){var t,n,l=(t=(0,r.useState)(e.daysToShow),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=l[0],a=l[1];return o().createElement(p.A,{isOpen:!0,toggle:e.cancel},o().createElement(b.A,{toggle:e.cancel},"Filter logs by"),o().createElement(E.A,null,o().createElement(A.A,null,o().createElement(N.A,null,o().createElement(w.A,{for:"text"},"How many days to show"),o().createElement(O.A,{id:"daysToShow",name:"daysToShow",type:"number",min:1,value:i,onChange:function(e){var t=e.target.value;a(parseInt(t,10))}})))),o().createElement(k.A,null,o().createElement(v.A,{color:"primary",onClick:function(){e.save({daysToShow:i})}},"Save")," ",o().createElement(v.A,{color:"secondary",onClick:e.cancel},"Cancel")))};function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const B=function(e){var t=M((0,r.useState)(!1),2),n=t[0],a=t[1],u=M((0,r.useState)(!1),2),c=u[0],s=u[1],m=M((0,r.useState)([]),2),y=m[0],p=m[1],b=["communication.crewNames"],E=[];function h(e){var t=JSON.parse(e.data);t.updates&&t.updates.forEach(function(e){e.values&&e.values.forEach(function(e){"communication.crewNames"!==e.path||JSON.stringify(y)!==JSON.stringify(e.value)&&p(e.value)})})}return(0,r.useEffect)(function(){var t;return fetch("/signalk/v1/api/vessels/self/communication/crewNames").then(function(e){return e.json()},function(){return[]}).then(function(e){return JSON.stringify(y)!==JSON.stringify(e.value)?(p(e.value),Promise.reject(new Error("Skip"))):Promise.resolve()}).then(function(){(t=e.adminUI.openWebsocket({subscribe:"none"})).onopen=function(){t.send(JSON.stringify({context:"vessels.self",subscribe:b.map(function(e){return{path:e,period:1e4}})}))},t.onmessage=h}).catch(function(){}),function(){t&&t.close()}},[y]),o().createElement(l.A,{xs:!0},n?o().createElement(D,{crewNames:y,cancel:function(){return a(!1)},save:function(t){fetch("/signalk/v1/api/vessels/self/communication/crewNames",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:t})}).then(function(){a(!1),p(t),setTimeout(function(){e.setNeedsUpdate(!0)},1e3)})},username:e.loginStatus.username}):null,c?o().createElement(I,{cancel:function(){return s(!1)},daysToShow:e.daysToShow,save:function(t){fetch("/signalk/v1/applicationData/user/signalk-logbook/1.0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:t})}).then(function(){s(!1),e.setDaysToShow(t.daysToShow),e.setNeedsUpdate(!0)})}}):null,o().createElement(i.A,null,o().createElement(d.A,{type:"unstyled"},o().createElement(f.A,null,o().createElement("b",null,"Crew")),y.map(function(e){return o().createElement(f.A,{key:e,onClick:function(){return a(!0)}},e)}),!y.length&&o().createElement(v.A,{onClick:function(){return a(!0)},size:"sm"},"Edit"))),o().createElement(i.A,null,o().createElement(d.A,{type:"unstyled"},o().createElement(f.A,null,o().createElement("b",null,"Show")),o().createElement(f.A,{onClick:function(){return s(!0)}},"Last ",e.daysToShow," days"))),o().createElement(i.A,{className:"text-end text-right"},o().createElement(d.A,{type:"unstyled"},o().createElement(f.A,null,o().createElement("b",null,"Sails")),E.map(function(e){var t="";return e.reducedState&&e.reducedState.reefs&&(t=" (".concat(g()(e.reducedState.reefs)," reef)")),e.reducedState&&e.reducedState.furledRatio&&(t=" (".concat(100*e.reducedState.furledRatio,"% furled)")),o().createElement(f.A,{key:e.id,onClick:function(){}},e.name,t)}),!E.length&&o().createElement(v.A,{onClick:function(){}},"Edit"))))};var G=n(8447),Z=n(8702),F=n(1187),U=n(412),R=n(2237),V=n(8354),W=n(7185);const z=function(e){var t=e.entry;return o().createElement("div",null,o().createElement("p",null,t.text," ",t.category&&o().createElement(V.A,{color:"secondary",pill:!0},"#",t.category)," ",t.end&&o().createElement(V.A,{color:"secondary",pill:!0},"#trip-end")),o().createElement(W.A,{borderless:!0,striped:!0,size:"sm"},o().createElement("tbody",null,t.point&&o().createElement("tr",null,o().createElement("th",null,"Position"),o().createElement("td",null,t.point.toString()," ",t.position.source||"GPS")),t.speed&&!Number.isNaN(Number(t.speed.sog))&&o().createElement("tr",null,o().createElement("th",null,"Speed"),o().createElement("td",null,t.speed.sog,"kt")),!Number.isNaN(Number(t.course))&&o().createElement("tr",null,o().createElement("th",null,"Course"),o().createElement("td",null,t.course,"°")),!Number.isNaN(Number(t.heading))&&o().createElement("tr",null,o().createElement("th",null,"Heading"),o().createElement("td",null,t.heading,"°")),t.wind&&o().createElement("tr",null,o().createElement("th",null,"Wind"),o().createElement("td",null,Number.isNaN(Number(t.wind.speed))?"":"".concat(t.wind.speed,"kt "),Number.isNaN(Number(t.wind.direction))?"":"".concat(t.wind.direction,"°"))),t.observations&&!Number.isNaN(Number(t.observations.seaState))&&o().createElement("tr",null,o().createElement("th",null,"Sea"),o().createElement("td",null,t.observations.seaState+1,": ",["","Glassy calm (0m)","Rippled calm (0-0.1m)","Smooth (0.1-0.5m)","Slight (0.5-1.25m)","Moderate (1.25-2.5m)","Rough (2.5-4m)","Very rough (4-6m)","High (6-9m)","Very high (9-14m)","Phenomenal (14m+)"][t.observations.seaState+1])),t.observations&&!Number.isNaN(Number(t.observations.cloudCoverage))&&o().createElement("tr",null,o().createElement("th",null,"Clouds"),o().createElement("td",null,["◯","⌽","◔","◔","◑","◕","◕","⬤"][t.observations.cloudCoverage]," ",t.observations.cloudCoverage,"/8")),t.observations&&!Number.isNaN(Number(t.observations.visibility))&&o().createElement("tr",null,o().createElement("th",null,"Visibility"),o().createElement("td",null,t.observations.visibility+1,": ",["","Dense fog (<45m)","Thick fog (<180m)","Fog (<360m)","Moderate fog (<0.5NM)","Thin fog (<1NM)","Poor visibility (<2NM)","Moderate visibility (<5NM)","Good visibility (<10NM)","Very good visibility (<30NM)","Excellent visibility (>30NM)"][t.observations.visibility+1])),"engine"===t.category&&t.engine&&o().createElement("tr",null,o().createElement("th",null,"Engine"),o().createElement("td",null,Number.isNaN(Number(t.engine.hours))?"":"".concat(t.engine.hours,"h "))),"radio"===t.category&&t.vhf&&o().createElement("tr",null,o().createElement("th",null,"VHF channel"),o().createElement("td",null,Number.isNaN(Number(t.vhf))?"":"".concat(t.vhf))))))};function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach(function(t){Y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Y(e,t,n){return(t=function(e){var t=function(e){if("object"!=H(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==H(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _=function(e){var t=e.entries.map(function(e){return $($({},e),{},{point:e.position?new R.Point(e.position.latitude,e.position.longitude):null,date:new Date(e.datetime)})});return t.reverse(),o().createElement("div",null,o().createElement(v.A,{color:"primary",onClick:e.addEntry},"Add entry"),t.map(function(t){return o().createElement(G.A,{key:t.datetime,onClick:function(){return e.editEntry(t)}},o().createElement(Z.A,null,o().createElement(l.A,null,o().createElement(i.A,{xs:"3"},t.author||"auto"),o().createElement(i.A,{className:"text-end text-right"},t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})))),o().createElement(F.A,null,o().createElement(U.A,null,o().createElement(z,{entry:t}))))}))};var q=n(937);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach(function(t){ee(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ee(e,t,n){return(t=function(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const te=function(e){var t=function(e){var t={};e.forEach(function(e){t[e.datetime]=e});var n=e.filter(function(t){return!e.some(function(e){return e.amends===t.datetime})}).map(function(e){for(var n=[e],r=e;r.amends;){var o=t[r.amends];if(!o)break;n.unshift(o),r=o}return n});return n.sort(function(e,t){return new Date(t[t.length-1].datetime)-new Date(e[e.length-1].datetime)}),n}(e.entries.map(function(e){return Q(Q({},e),{},{point:e.position?new R.Point(e.position.latitude,e.position.longitude):null,date:new Date(e.datetime)})}));return o().createElement("div",null,o().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},o().createElement("div",{style:{fontWeight:"bold"}},"Logbook"),o().createElement(v.A,{color:"primary",onClick:e.addEntry},"Add entry")),o().createElement(W.A,{striped:!0,hover:!0,responsive:!0},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",null),o().createElement("th",null,"Time"),o().createElement("th",null,"Course"),o().createElement("th",null,"Speed"),o().createElement("th",null,"Weather"),o().createElement("th",null,"Baro"),o().createElement("th",null,"Coordinates"),o().createElement("th",null,"Fix"),o().createElement("th",null,"speed"),o().createElement("th",null,"Engine"),o().createElement("th",null,"By"),o().createElement("th",null,"Remarks"))),o().createElement("tbody",null,t.map(function(t,n){var r,l=t[t.length-1];return o().createElement(o().Fragment,{key:l.datetime},o().createElement("tr",{onClick:function(){return e.editEntry(l)}},o().createElement("td",null),o().createElement("td",null,l.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})),o().createElement("td",null,(r=l,Number.isNaN(Number(r.course))?Number.isNaN(Number(r.heading))?"":"HDT ".concat(r.heading,"°"):"".concat(r.course,"°"))),o().createElement("td",null,l.speed&&!Number.isNaN(Number(l.speed.sog))?"".concat(l.speed.sog,"kt"):""),o().createElement("td",null,function(e){var t=[];if(e.wind){var n=[];Number.isNaN(Number(e.wind.speed))||n.push("".concat(e.wind.speed,"kt")),Number.isNaN(Number(e.wind.direction))||n.push("".concat(e.wind.direction,"°")),n.length&&t.push("Wind ".concat(n.join(" ")))}return e.observations&&(Number.isNaN(Number(e.observations.seaState))||t.push("Sea state ".concat(e.observations.seaState)),Number.isNaN(Number(e.observations.cloudCoverage))||t.push("Clouds ".concat(e.observations.cloudCoverage,"/8")),Number.isNaN(Number(e.observations.visibility))||t.push("Visibility ".concat(e.observations.visibility+1))),t.join(", ")}(l)),o().createElement("td",null,l.barometer),o().createElement("td",null,l.point?l.point.toString():"n/a"),o().createElement("td",null,l.position?l.position.source||"GPS":""),o().createElement("td",null,l.speed&&!Number.isNaN(Number(l.speed.sog||l.speed.stw))?"".concat(Number(l.speed.sog||l.speed.stw),"kt"):""),o().createElement("td",null,l.engine&&!Number.isNaN(Number(l.engine.hours))?"".concat(l.engine.hours,"h"):""),o().createElement("td",null,l.author||"auto",!1===l.signatureValid&&o().createElement("span",{title:"Logikirje on muudetud või rikutud",style:{color:"red",marginLeft:4}},o().createElement(q.BS8,null))),o().createElement("td",null,l.text)),t.length>1&&t.slice(0,-1).map(function(t,n){return o().createElement("tr",{key:t.datetime,style:{background:"#f6f6f6",fontSize:"0.95em"}},o().createElement("td",null),o().createElement("td",{colSpan:11,style:{paddingLeft:48,borderLeft:"3px solid #bbb"}},o().createElement("span",{style:{color:"#888"}},o().createElement("b",null,t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone}))," — ",t.text)))}))}))),o().createElement(v.A,{color:"primary",onClick:e.addEntry},"Add entry"))};var ne=n(1425),re=n(2728);function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function le(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(e,t)||se(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach(function(t){ue(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ue(e,t,n){return(t=function(e){var t=function(e){if("object"!=oe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==oe(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ce(e){return function(e){if(Array.isArray(e))return me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||se(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){if(e){if("string"==typeof e)return me(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(e,t):void 0}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const de=function(e){var t=e.entries.filter(function(e){return e.position}).map(function(e){return ae(ae({},e),{},{point:new R.Point(e.position.latitude,e.position.longitude),date:new Date(e.datetime)})}),n=le((0,r.useState)(t.map(function(e){return{lat:e.position.latitude,lon:e.position.longitude}})),2),l=n[0],i=n[1],a=le((0,r.useState)([640,480]),2),u=a[0],c=a[1],s=(0,r.useRef)(null);(0,r.useEffect)(function(){if(s.current){var e=s.current.getBoundingClientRect();c([e.width,e.height])}},[]);var m=(0,re.R)(function(e){if(!e.length)return[0,0,0,0];var t=e.map(function(e){return e.lon}),n=e.map(function(e){return e.lat});return[Math.min.apply(Math,ce(n)),Math.min.apply(Math,ce(t)),Math.max.apply(Math,ce(n)),Math.max.apply(Math,ce(t))]}(l),u);m.zoom-=1.5,(0,r.useEffect)(function(){if(!(t.length<2)){var e=t.reduce(function(e,t){var n=t.datetime.substr(0,10);return-1===e.indexOf(n)&&e.push(n),e},[]),n=t[0].datetime,r=t[t.length-1].datetime;fetch("/signalk/v1/history/values?from=".concat(n,"&to=").concat(r,"&paths=navigation.position&resolution=").concat(300)).then(function(e){return e.json()}).then(function(t){if(t.data&&t.data.length){var n,r=[];t.data.forEach(function(t){if(t.length&&-1!==e.indexOf(t[0].substr(0,10))&&t[1]){var o=new R.Point(t[1][1],t[1][0]);n&&n.distanceTo(o)<.04||(n=o,r.push({lat:o.lat,lon:o.lon}))}}),i(r)}}).catch(function(){})}},[e.entries]);var d={type:"FeatureCollection",features:l.slice(1).map(function(e,t){var n=l[t];return!n||Number.isNaN(Number(n.lat))||Number.isNaN(Number(n.lon))||!e||Number.isNaN(Number(e.lat))||Number.isNaN(Number(e.lon))?null:{type:"feature",geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[e.lon,e.lat]]}}}).filter(function(e){return null!==e})};return o().createElement("div",{ref:s,style:{width:"80vw",height:"80vh"}},o().createElement(ne.T5,{center:m.center,zoom:m.zoom},o().createElement(ne.s7,{data:d,styleCallback:function(){return{strokeWidth:"1",stroke:"red"}}}),t.map(function(t){var n="#009bdb";return"engine"===t.category&&(n="#ed1b2f"),"radio"===t.category&&(n="#00ae9d"),o().createElement(ne.pH,{key:t.datetime,color:n,anchor:[t.position.latitude,t.position.longitude],onClick:function(){return e.viewEntry(t)}})})))};var fe=n(2223);function ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const ge=function(e){var t=ve((0,r.useState)([]),2),n=t[0],l=t[1],i=ve((0,r.useState)(null),2),a=i[0],u=i[1],c=ve((0,r.useState)([]),2),s=c[0],m=c[1],d=ve((0,r.useState)(!1),2),f=d[0],y=d[1],g=ve((0,r.useState)(null),2),h=g[0],S=g[1];function A(e){return new Date(e).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}return(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){l(e.sort().reverse())}).catch(function(e){console.error("Error fetching days:",e)})},[]),o().createElement("div",null,o().createElement(G.A,null,o().createElement(Z.A,null,o().createElement("h4",null,"Service - Log Management"),o().createElement("p",{className:"text-muted mb-0"},"Delete log entries by day. This action cannot be undone.")),o().createElement(F.A,null,"success"===h&&o().createElement(fe.A,{color:"success",onDismiss:function(){return S(null)}},"Day deleted successfully!"),"error"===h&&o().createElement(fe.A,{color:"danger",onDismiss:function(){return S(null)}},"Error deleting day. Please try again."),o().createElement("div",{className:"row"},o().createElement("div",{className:"col-md-6"},o().createElement("h5",null,"Available Days"),o().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},n.map(function(e){return o().createElement(G.A,{key:e,className:"mb-2 ".concat(a===e?"border-primary":""),style:{cursor:"pointer"},onClick:function(){return function(e){u(e),fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()}).then(function(e){m(e)}).catch(function(e){console.error("Error fetching entries:",e),m([])})}(e)}},o().createElement(F.A,{className:"py-2"},o().createElement("div",{className:"d-flex justify-content-between align-items-center"},o().createElement("div",null,o().createElement("strong",null,A(e)),o().createElement("br",null),o().createElement("small",{className:"text-muted"},e)),a===e&&o().createElement(v.A,{color:"danger",size:"sm",onClick:function(e){e.stopPropagation(),y(!0)}},"Delete"))))}),0===n.length&&o().createElement("p",{className:"text-muted"},"No log entries found."))),o().createElement("div",{className:"col-md-6"},o().createElement("h5",null,"Entries for Selected Day"),a&&s.length>0?o().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},o().createElement(W.A,{size:"sm"},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",null,"Time"),o().createElement("th",null,"Category"),o().createElement("th",null,"Text"),o().createElement("th",null,"Author"))),o().createElement("tbody",null,s.map(function(t){return o().createElement("tr",{key:t.datetime},o().createElement("td",null,(n=t.datetime,new Date(n).toLocaleTimeString("en-GB",{timeZone:e.displayTimeZone||"UTC",hour:"2-digit",minute:"2-digit"}))),o().createElement("td",null,o().createElement("span",{className:"badge bg-".concat("navigation"===t.category?"primary":"engine"===t.category?"danger":"radio"===t.category?"success":"secondary")},t.category)),o().createElement("td",null,o().createElement("div",{style:{maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"}},t.text)),o().createElement("td",null,t.author||"auto"));var n})))):a?o().createElement("p",{className:"text-muted"},"No entries found for this day."):o().createElement("p",{className:"text-muted"},"Select a day to view entries."))))),o().createElement(p.A,{isOpen:f,toggle:function(){return y(!1)}},o().createElement(b.A,{toggle:function(){return y(!1)}},"Confirm Delete"),o().createElement(E.A,null,"Are you sure you want to delete all log entries for ",o().createElement("strong",null,a?A(a):""),"?",o().createElement("br",null),o().createElement("br",null),"This action cannot be undone and will permanently remove ",s.length," log entries."),o().createElement(k.A,null,o().createElement(v.A,{color:"danger",onClick:function(){a&&(S("deleting"),fetch("/plugins/signalk-logbook/logs/".concat(a),{method:"DELETE"}).then(function(t){t.ok?(S("success"),l(n.filter(function(e){return e!==a})),u(null),m([]),e.onDataChange&&e.onDataChange()):S("error")}).catch(function(e){console.error("Error deleting day:",e),S("error")}))},disabled:"deleting"===h},"deleting"===h?"Deleting...":"Delete"),o().createElement(v.A,{color:"secondary",onClick:function(){return y(!1)}},"Cancel"))))};var pe=n(9575),be=n(8332),Ee=n(9654),he=n(2113),Se=n(8227),Ae=n(1909);function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach(function(t){ke(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ke(e,t,n){return(t=function(e){var t=function(e){if("object"!=Ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ne(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function je(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ce(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ce(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Pe(e){return null==e||isNaN(e)?null:Number((1.94384*e).toFixed(1))}const Te=function(e){var t,n,l,i,a,u,c,s,m,d,f,y,g=e.entry&&void 0!==e.entry.ago,h=je((0,r.useState)({}),2),S=h[0],j=h[1],C=je((0,r.useState)(function(){return Oe(g?{text:"",category:e.categories[0]||"",ago:0,observations:{},position:e.entry&&e.entry.position?Oe({},e.entry.position):{}}:{},e.entry)}),2),P=C[0],T=C[1];(0,r.useEffect)(function(){T(Oe(g?{text:"",category:e.categories[0]||"",ago:0,observations:{},position:e.entry&&e.entry.position?Oe({},e.entry.position):{}}:{},e.entry))},[e.entry]),(0,r.useEffect)(function(){fetch("".concat(window.location.origin,"/signalk/v1/api/vessels/self"),{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){var t,n,r,o,l,i,a,u,c,s,m,d,f,v,y,p,b,E,h=(e&&e.environment||{}).wind||{},S=null==e||null===(t=e.environment)||void 0===t||null===(t=t.outside)||void 0===t||null===(t=t.pressure)||void 0===t?void 0:t.value,A=null==e||null===(n=e.environment)||void 0===n||null===(n=n.outside)||void 0===n||null===(n=n.visibility)||void 0===n?void 0:n.value,N=null!==(r=null!==(o=null===(l=h.speedTrue)||void 0===l?void 0:l.value)&&void 0!==o?o:null===(i=h.speedApparent)||void 0===i?void 0:i.value)&&void 0!==r?r:null===(a=h.speedOverGround)||void 0===a?void 0:a.value,w=null!==(u=null===(c=h.directionTrue)||void 0===c?void 0:c.value)&&void 0!==u?u:null===(s=h.directionMagnetic)||void 0===s?void 0:s.value,O=Pe(N),k={windSpeed:O,windDirection:null!=w?Math.round((180*Number(w)/Math.PI+360)%360):null,barometer:null!=S?Number(S)>2e3?Number((Number(S)/100).toFixed(2)):Number(Number(S).toFixed(2)):null,sog:Pe(null==e||null===(m=e.navigation)||void 0===m||null===(m=m.speedOverGround)||void 0===m?void 0:m.value),stw:Pe(null==e||null===(d=e.navigation)||void 0===d||null===(d=d.speedThroughWater)||void 0===d?void 0:d.value),cog:null!=(null==e||null===(f=e.navigation)||void 0===f||null===(f=f.courseOverGroundTrue)||void 0===f?void 0:f.value)?Math.round((180*Number(e.navigation.courseOverGroundTrue.value)/Math.PI+360)%360):null,hdt:null!=(null==e||null===(v=e.navigation)||void 0===v||null===(v=v.headingTrue)||void 0===v?void 0:v.value)?Math.round((180*Number(e.navigation.headingTrue.value)/Math.PI+360)%360):null,depth:null!==(y=null==e||null===(p=e.environment)||void 0===p||null===(p=p.depth)||void 0===p||null===(p=p.belowTransducer)||void 0===p?void 0:p.value)&&void 0!==y?y:null,waterTemp:null!=(null==e||null===(b=e.environment)||void 0===b||null===(b=b.water)||void 0===b||null===(b=b.temperature)||void 0===b?void 0:b.value)?Number(e.environment.water.temperature.value-273.15).toFixed(1):null,logNm:null!=(null==e||null===(E=e.navigation)||void 0===E||null===(E=E.log)||void 0===E?void 0:E.value)?Number((Number(e.navigation.log.value)/1852).toFixed(1)):null};j(k),g&&T(function(t){var n,r,o=Oe({},t);if((null!=O||null!=w)&&(o.wind=Oe({},o.wind||{}),null!=O&&(o.wind.speed=O),null!=w)){var l=Math.round((180*Number(w)/Math.PI+360)%360);o.wind.direction=l}o.observations=Oe({},o.observations||{}),null==o.observations.seaState&&null!=O&&(o.observations.seaState=function(e){if(null==e||isNaN(e))return null;var t=Number(e);return t<=1?0:t<=3?1:t<=6?2:t<=10?3:t<=16?4:t<=21?5:t<=27?6:t<=33?7:t<=40?8:t<=47?9:t<=55?10:t<=63?11:12}(O));var i,a=null==(i=A)||isNaN(i)?null:i<45?1:i<180?2:i<360?3:i<926?4:i<1852?5:i<3704?6:i<9260?7:i<18520?8:i<55560?9:10;if(null==o.observations.visibility&&null!=a&&(o.observations.visibility=a),null!=S){var u=Number(S);o.barometer=Number(u>2e3?(u/100).toFixed(2):u.toFixed(2))}var c=null!=(null==e||null===(n=e.navigation)||void 0===n||null===(n=n.log)||void 0===n?void 0:n.value)?e.navigation.log.value:null==e||null===(r=e.navigation)||void 0===r||null===(r=r.trip)||void 0===r||null===(r=r.log)||void 0===r?void 0:r.value;return null!=c&&(o.log=Number((Number(c)/1852).toFixed(1))),o})})},[g,e.entry]),(0,r.useEffect)(function(){g&&console.log("Add entry: props.entry.position =",e.entry&&e.entry.position)},[g,e.entry]);var D=[],x=P;if(e.allEntries&&P&&!g){for(var I=P;I.amends;){var M=e.allEntries.find(function(e){return e.datetime===I.amends});if(!M)break;I=M}for(var L=[I],B=e.allEntries.find(function(e){return e.amends===I.datetime});B;)L.push(B),B=e.allEntries.find(function(e){return e.amends===B.datetime});(D=[].concat(L).reverse()).length>1&&(x=D[D.length-1])}var G=[];function Z(e){var t=e.target,n=t.name,r=t.value,o=t.type;T(function(e){var t=Oe({},e);switch(n){case"seaState":case"cloudCoverage":case"visibility":t.observations=Oe({},t.observations);var l=parseInt(r,10);-1===l?delete t.observations[n]:t.observations[n]=l;break;case"latitude":case"longitude":case"source":t.position=Oe({},t.position),t.position[n]="source"===n?r:Number(r);break;case"ago":t.ago=parseInt(r,10);break;default:t[n]="number"===o?Number(r):r}return t})}D.length>1&&(G=D.slice(0,-1)),e.allEntries&&x&&!g&&e.allEntries.some(function(e){return e.amends===x.datetime}),e.allEntries&&x&&!g&&e.allEntries.filter(function(e){return e.datetime!==x.datetime}).sort(function(e,t){return new Date(t.datetime)-new Date(e.datetime)}).slice(0,5);var F=je((0,r.useState)(""),2),U=F[0],R=F[1];function V(e){return!!g||!function(e){return e&&("Automatic"===e.author||"Automatic log entry"===e.text)}(x)}return g&&P.ago&&Number(P.ago),g&&(!P.ago||Number(P.ago)),o().createElement(p.A,{isOpen:!0,toggle:e.cancel},o().createElement(b.A,{toggle:e.cancel},g?"New entry":"Log entry ".concat(new Date(x.date||x.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})," by ").concat(x.author||"auto")),o().createElement(E.A,null,o().createElement(A.A,null,o().createElement(N.A,null,o().createElement(w.A,{for:"text"},"Remarks"),G.length>0&&o().createElement("div",{style:{border:"1px solid #eee",borderRadius:4,padding:8,background:"#fafbfc",marginBottom:8}},o().createElement("div",{style:{fontWeight:"bold",marginBottom:4}},"Previous entries"),G.map(function(t){return o().createElement("div",{key:t.datetime,style:{marginBottom:6}},o().createElement("div",{style:{fontSize:"0.9em",color:"#888"}},new Date(t.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})),o().createElement("div",{style:{fontWeight:"bold"}},t.text))})),o().createElement(O.A,{id:"text",name:"text",type:"textarea",placeholder:"Tell what happened",value:P.text||"",onChange:Z,disabled:!V()})),o().createElement("div",{style:{borderTop:"1px solid #eee",marginTop:12,paddingTop:12}},o().createElement("div",{style:{fontWeight:"bold",marginBottom:8}},"Live readings"),o().createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8}},o().createElement("div",null,"Wind: ",null!=S.windSpeed?"".concat(S.windSpeed," kt"):"n/a"," ",null!=S.windDirection?"(".concat(S.windDirection,"°)"):""),o().createElement("div",null),o().createElement("div",null,"Log: ",null!=S.logNm?"".concat(S.logNm," NM"):"n/a"),o().createElement("div",null,"SOG/STW: ",null!=S.sog?"".concat(S.sog," /"):""," ",null!=S.stw?"".concat(S.stw," kt"):""),o().createElement("div",null,"COG/HDT: ",null!=S.cog?"".concat(S.cog,"° /"):""," ",null!=S.hdt?"".concat(S.hdt,"°"):""),o().createElement("div",null,"Depth: ",null!=S.depth?"".concat(S.depth," m"):"n/a"),o().createElement("div",null,"Water temp: ",null!=S.waterTemp?"".concat(S.waterTemp," °C"):"n/a"))),D.length>1&&o().createElement(N.A,null,o().createElement(w.A,null,"Previous versions"),o().createElement("div",{style:{border:"1px solid #eee",borderRadius:4,padding:8,background:"#fafbfc"}},D.slice(0,-1).map(function(t){return o().createElement("div",{key:t.datetime,style:{marginBottom:6}},o().createElement("div",{style:{fontSize:"0.9em",color:"#888"}},new Date(t.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})),o().createElement("div",{style:{fontWeight:"bold"}},t.text))}))),g&&o().createElement(N.A,null,o().createElement(w.A,{for:"ago"},"This happened"),o().createElement(O.A,{id:"ago",name:"ago",type:"select",value:P.ago,onChange:Z,disabled:!V()},[0,5,10,15].map(function(e){return o().createElement("option",{key:e,value:e},e," minutes ago")}))),o().createElement(N.A,null,o().createElement(w.A,{for:"category"},"Category"),o().createElement(O.A,{id:"category",name:"category",type:"select",value:P.category||"",onChange:Z,disabled:!V()},e.categories.map(function(e){return o().createElement("option",{key:e,value:e},e)}))),"radio"===P.category&&o().createElement(N.A,null,o().createElement(w.A,{for:"vhf"},"VHF channel"),o().createElement(O.A,{id:"vhf",name:"vhf",placeholder:"16",value:P.vhf||"",onChange:Z,disabled:!V()})),"navigation"===P.category&&o().createElement(pe.A,{open:U,toggle:function(e){R(U===e?"":e)}},o().createElement(be.A,null,o().createElement(Ee.A,{targetId:"observations"},"Observations"),o().createElement(he.A,{accordionId:"observations"},o().createElement(N.A,null,o().createElement(w.A,{for:"seaState"},"Sea state"),o().createElement(O.A,{id:"seaState",name:"seaState",type:"select",value:null!==(t=null===(n=P.observations)||void 0===n?void 0:n.seaState)&&void 0!==t?t:-1,onChange:Z,disabled:!V()},["","Glassy calm (0m)","Rippled calm (0-0.1m)","Smooth (0.1-0.5m)","Slight (0.5-1.25m)","Moderate (1.25-2.5m)","Rough (2.5-4m)","Very rough (4-6m)","High (6-9m)","Very high (9-14m)","Phenomenal (14m+)"].map(function(e,t){return o().createElement("option",{key:t,value:t-1},e)}))),o().createElement(N.A,null,o().createElement(w.A,{for:"cloudCoverage"},"Cloud coverage"),o().createElement(Se.A,null,o().createElement(O.A,{id:"cloudCoverage",name:"cloudCoverage",type:"range",min:"-1",max:"8",step:"1",value:null!==(l=null===(i=P.observations)||void 0===i?void 0:i.cloudCoverage)&&void 0!==l?l:-1,onChange:Z,disabled:!V()}),o().createElement(Ae.A,null,P.observations&&P.observations.cloudCoverage>-1?"".concat(P.observations.cloudCoverage,"/8"):"n/a"))),o().createElement(N.A,null,o().createElement(w.A,{for:"visibility"},"Visibility"),o().createElement(O.A,{id:"visibility",name:"visibility",type:"select",value:null!==(a=null===(u=P.observations)||void 0===u?void 0:u.visibility)&&void 0!==a?a:-1,onChange:Z,disabled:!V()},["","Dense fog (<45m)","Thick fog (<180m)","Fog (<360m)","Moderate fog (<0.5NM)","Thin fog (<1NM)","Poor visibility (<2NM)","Moderate visibility (<5NM)","Good visibility (<10NM)","Very good visibility (<30NM)","Excellent visibility (>30NM)"].map(function(e,t){return o().createElement("option",{key:t,value:t-1},e)}))))),o().createElement(be.A,null,o().createElement(Ee.A,{targetId:"position"},"Position"),o().createElement(he.A,{accordionId:"position"},o().createElement(N.A,null,o().createElement(w.A,{for:"latitude"},"Latitude"),o().createElement(O.A,{id:"latitude",name:"latitude",type:"number",placeholder:"52.51117",max:"90",min:"-90",step:"0.00001",value:null!==(c=null===(s=P.position)||void 0===s?void 0:s.latitude)&&void 0!==c?c:"",onChange:Z,disabled:!1})),o().createElement(N.A,null,o().createElement(w.A,{for:"longitude"},"Longitude"),o().createElement(O.A,{id:"longitude",name:"longitude",type:"number",placeholder:"13.19329",max:"180",min:"-180",step:"0.00001",value:null!==(m=null===(d=P.position)||void 0===d?void 0:d.longitude)&&void 0!==m?m:"",onChange:Z,disabled:!1})),o().createElement(N.A,null,o().createElement(w.A,{for:"source"},"Fix type"),o().createElement(O.A,{id:"source",name:"source",type:"select",value:null!==(f=null===(y=P.position)||void 0===y?void 0:y.source)&&void 0!==f?f:"",onChange:Z,disabled:!1},["GPS","GNSS","Visual","Radar","Celestial","DR"].map(function(e){return o().createElement("option",{key:e,value:e},e)})))))))),o().createElement(k.A,null,o().createElement(v.A,{color:"primary",onClick:function(){if(P.text&&""!==P.text.trim()){var t=Oe({},P);if("navigation"!==t.category)delete t.position;else{var n,r,o,l=null===(n=t.position)||void 0===n?void 0:n.latitude,i=null===(r=t.position)||void 0===r?void 0:r.longitude,a=null===(o=t.position)||void 0===o?void 0:o.source;if(void 0!==l&&""!==l||!document.getElementById("latitude")||(l=document.getElementById("latitude").value),void 0!==i&&""!==i||!document.getElementById("longitude")||(i=document.getElementById("longitude").value),void 0!==a&&""!==a||!document.getElementById("source")||(a=document.getElementById("source").value),!l||!i)return void alert("Palun sisesta asukoht (latitude ja longitude)!");if(t.position={latitude:parseFloat(l),longitude:parseFloat(i),source:a||"GPS"},isNaN(t.position.latitude)||isNaN(t.position.longitude))return void alert("Latitude ja longitude peavad olema numbrid!")}t.datetime||(t.datetime=(new Date).toISOString()),e.save(t)}else alert("Logikirje tekst ('Remarks') on kohustuslik!")}},"Save")," ",o().createElement(v.A,{color:"secondary",onClick:e.cancel},"Cancel")))},De=function(e){var t=e.entry;return o().createElement(p.A,{isOpen:!0,toggle:e.cancel},o().createElement(b.A,{toggle:e.cancel},"Log entry ",t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})," by ",t.author||"auto"),o().createElement(E.A,null,o().createElement(z,{entry:t})),o().createElement(k.A,null,o().createElement(v.A,{color:"primary",onClick:function(){return e.editEntry(t)}},"Edit")," ",o().createElement(v.A,{color:"secondary",onClick:e.cancel},"Close")))};function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach(function(t){Le(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Le(e,t,n){return(t=function(e){var t=function(e){if("object"!=xe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=xe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==xe(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ge(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ge(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ze=["navigation","engine","radio","maintenance"];const Fe=function(e){var t=Be((0,r.useState)({entries:[]}),2),n=t[0],d=t[1],f=Be((0,r.useState)("timeline"),2),v=f[0],y=f[1],g=Be((0,r.useState)(7),2),p=g[0],b=g[1],E=Be((0,r.useState)(null),2),h=E[0],S=E[1],A=Be((0,r.useState)(null),2),N=A[0],w=A[1],O=Be((0,r.useState)(null),2),k=O[0],j=O[1],C=Be((0,r.useState)(!0),2),P=C[0],T=C[1],D=Be((0,r.useState)("UTC"),2),x=D[0],I=D[1],M=Be((0,r.useState)(""),2),L=M[0],G=M[1],Z=Be((0,r.useState)(null),2),F=(Z[0],Z[1]),U=Be((0,r.useState)(null),2),R=U[0],V=U[1],W=e.loginStatus.status;function z(e){var t=Me({},e);delete t.signatureValid,delete t.audit,fetch("/plugins/signalk-logbook/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){j(null),T(!0)})}return(0,r.useEffect)(function(){function e(){fetch("/signalk/v1/api/vessels/self/").then(function(e){return e.json()}).then(function(e){var t=null;e&&e.navigation&&e.navigation.position&&e.navigation.position.value&&(t=e.navigation.position.value),t&&"number"==typeof t.latitude&&"number"==typeof t.longitude&&V({latitude:t.latitude,longitude:t.longitude,source:"GPS"})})}e();var t=setInterval(e,5e3);return function(){return clearInterval(t)}},[]),(0,r.useEffect)(function(){if(P&&"notLoggedIn"!==W){var e=setInterval(function(){T(!0)},3e5);return fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){var t=new Date;t.setDate(t.getDate()-p);var n=e.filter(function(e){return e>=t.toISOString().substr(0,10)});Promise.all(n.map(function(e){return fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()})})).then(function(e){var t=[].concat.apply([],e);d({entries:t}),T(!1);var n=t.filter(function(e){return"navigation"===e.category&&e.position&&void 0!==e.position.latitude&&void 0!==e.position.longitude}).sort(function(e,t){return new Date(t.datetime)-new Date(e.datetime)})[0];n&&F(Me({},n.position))})}),function(){clearInterval(e)}}},[p,P,W]),(0,r.useEffect)(function(){fetch("/signalk/v1/applicationData/user/signalk-logbook/1.0").then(function(e){return e.json()}).then(function(e){e&&e.filter&&e.filter.daysToShow&&b(e.filter.daysToShow)})},[W]),(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/config").then(function(e){return e.json()}).then(function(e){e.configuration&&e.configuration.displayTimeZone&&I(e.configuration.displayTimeZone)})},[x]),(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/version").then(function(e){return e.json()}).then(function(e){e&&e.version&&G(e.version)})},[]),"notLoggedIn"===e.loginStatus.status&&e.loginStatus.authenticationRequired?o().createElement(e.adminUI.Login,null):o().createElement("div",null,o().createElement(B,{adminUI:e.adminUI,loginStatus:e.loginStatus,daysToShow:p,setDaysToShow:b,setNeedsUpdate:T}),o().createElement(l.A,null,h?o().createElement(Te,{entry:h,cancel:function(){return S(null)},save:function(e){if(e.datetime&&!Number.isNaN(Date.parse(e.datetime))){var t=Me(Me({},e),{},{amends:e.datetime,datetime:(new Date).toISOString()});return delete t.point,delete t.date,delete t.signatureValid,void fetch("/plugins/signalk-logbook/logs/".concat(e.datetime.substr(0,10),"/").concat(e.datetime),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){S(null),T(!0)})}z(e)},delete:function(e){var t=new Date(e.datetime).toISOString().substr(0,10);fetch("/plugins/signalk-logbook/logs/".concat(t,"/").concat(e.datetime),{method:"DELETE"}).then(function(){S(null),T(!0)})},categories:Ze,displayTimeZone:x,allEntries:n.entries}):null,N?o().createElement(De,{entry:N,editEntry:S,cancel:function(){return w(null)},categories:Ze,displayTimeZone:x}):null,k?o().createElement(Te,{entry:k,cancel:function(){return j(null)},save:z,categories:Ze}):null,o().createElement(i.A,{className:"bg-light border"},o().createElement(a.A,{tabs:!0},o().createElement(u.A,null,o().createElement(c.A,{className:"timeline"===v?"active":"",onClick:function(){return y("timeline")}},"Timeline")),o().createElement(u.A,null,o().createElement(c.A,{className:"book"===v?"active":"",onClick:function(){y("book"),e.adminUI.hideSideBar()}},"Logbook")),o().createElement(u.A,null,o().createElement(c.A,{className:"map"===v?"active":"",onClick:function(){return y("map")}},"Map")),o().createElement(u.A,null,o().createElement(c.A,{className:"service"===v?"active":"",onClick:function(){return y("service")}},"Service"))),o().createElement(s.A,{activeTab:v},o().createElement(m.A,{tabId:"timeline"},"timeline"===v?o().createElement(_,{entries:n.entries,displayTimeZone:x,editEntry:S,addEntry:function(){return j({ago:0,category:"navigation",position:R})}}):null),o().createElement(m.A,{tabId:"book"},"book"===v?o().createElement(te,{entries:n.entries,displayTimeZone:x,editEntry:S,addEntry:function(){return j({ago:0,category:"navigation",position:R})}}):null),o().createElement(m.A,{tabId:"map"},"map"===v?o().createElement(de,{entries:n.entries,editEntry:S,viewEntry:w}):null),o().createElement(m.A,{tabId:"service"},"service"===v?o().createElement(ge,{displayTimeZone:x,onDataChange:function(){return T(!0)}}):null)))),o().createElement("div",{style:{fontFamily:"monospace",fontSize:"1.2em",color:"#007bff"}},"Plugin version ",L||"..."," (live test)"))}}}]);