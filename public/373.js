"use strict";(self.webpackChunksignalk_logbook=self.webpackChunksignalk_logbook||[]).push([[373],{4107:(e,t,n)=>{n.r(t),n.d(t,{default:()=>We});var r=n(4823),l=n.n(r),o=n(9217),a=n(527),i=n(6664),u=n(7299),c=n(6980),s=n(3481),m=n(6644),d=n(4745),f=n(1883),y=n(949),v=n(1631),p=n.n(v),g=n(2706),b=n(3325),E=n(6768),h=n(26),S=n(7237),A=n(7587),N=n(4428),w=n(727),O=n(8337),k=n(8255);function j(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return P(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const x=function(e){var t=C((0,r.useState)(e.crewNames),2),n=t[0],o=t[1],a=C((0,r.useState)(n.includes(e.username)?"":e.username),2),i=a[0],u=a[1];function c(){if(i){var e=[].concat(j(n),[i]);o(e),u("")}}return l().createElement(g.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},"Crew"),l().createElement(E.A,null,l().createElement(h.A,{flush:!0},n.map(function(e,t){return l().createElement(S.A,{key:e},l().createElement(y.A,{onClick:function(){var e=j(n);e.splice(t,1),o(e)}},"X")," ",e)})),l().createElement(A.A,null,l().createElement(N.A,null,l().createElement(w.A,{for:"add"},"Add crew"),l().createElement(O.A,{id:"add",name:"add",placeholder:"bergie",color:"primary",value:i,onChange:function(e){var t=e.target.value;u(t)},onKeyPress:function(e){"Enter"===e.key&&(c(),e.stopPropagation(),e.preventDefault())}}),l().createElement(y.A,{onClick:c},"Add")))),l().createElement(k.A,null,l().createElement(y.A,{color:"primary",onClick:function(){return e.save(n)}},"Save")," ",l().createElement(y.A,{color:"secondary",onClick:e.cancel},"Cancel")))};function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const I=function(e){var t,n,o=(t=(0,r.useState)(e.daysToShow),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],i=o[1];return l().createElement(g.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},"Filter logs by"),l().createElement(E.A,null,l().createElement(A.A,null,l().createElement(N.A,null,l().createElement(w.A,{for:"text"},"How many days to show"),l().createElement(O.A,{id:"daysToShow",name:"daysToShow",type:"number",min:1,value:a,onChange:function(e){var t=e.target.value;i(parseInt(t,10))}})))),l().createElement(k.A,null,l().createElement(y.A,{color:"primary",onClick:function(){e.save({daysToShow:a})}},"Save")," ",l().createElement(y.A,{color:"secondary",onClick:e.cancel},"Cancel")))};function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const B=function(e){var t=M((0,r.useState)(!1),2),n=t[0],i=t[1],u=M((0,r.useState)(!1),2),c=u[0],s=u[1],m=M((0,r.useState)([]),2),v=m[0],g=m[1],b=["communication.crewNames"],E=[];function h(e){var t=JSON.parse(e.data);t.updates&&t.updates.forEach(function(e){e.values&&e.values.forEach(function(e){"communication.crewNames"!==e.path||JSON.stringify(v)!==JSON.stringify(e.value)&&g(e.value)})})}return(0,r.useEffect)(function(){var t;return fetch("/signalk/v1/api/vessels/self/communication/crewNames").then(function(e){return e.json()},function(){return[]}).then(function(e){return JSON.stringify(v)!==JSON.stringify(e.value)?(g(e.value),Promise.reject(new Error("Skip"))):Promise.resolve()}).then(function(){(t=e.adminUI.openWebsocket({subscribe:"none"})).onopen=function(){t.send(JSON.stringify({context:"vessels.self",subscribe:b.map(function(e){return{path:e,period:1e4}})}))},t.onmessage=h}).catch(function(){}),function(){t&&t.close()}},[v]),l().createElement(o.A,{xs:!0},n?l().createElement(x,{crewNames:v,cancel:function(){return i(!1)},save:function(t){fetch("/signalk/v1/api/vessels/self/communication/crewNames",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:t})}).then(function(){i(!1),g(t),setTimeout(function(){e.setNeedsUpdate(!0)},1e3)})},username:e.loginStatus.username}):null,c?l().createElement(I,{cancel:function(){return s(!1)},daysToShow:e.daysToShow,save:function(t){fetch("/signalk/v1/applicationData/user/signalk-logbook/1.0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:t})}).then(function(){s(!1),e.setDaysToShow(t.daysToShow),e.setNeedsUpdate(!0)})}}):null,l().createElement(a.A,null,l().createElement(d.A,{type:"unstyled"},l().createElement(f.A,null,l().createElement("b",null,"Crew")),v.map(function(e){return l().createElement(f.A,{key:e,onClick:function(){return i(!0)}},e)}),!v.length&&l().createElement(y.A,{onClick:function(){return i(!0)},size:"sm"},"Edit"))),l().createElement(a.A,null,l().createElement(d.A,{type:"unstyled"},l().createElement(f.A,null,l().createElement("b",null,"Show")),l().createElement(f.A,{onClick:function(){return s(!0)}},"Last ",e.daysToShow," days"))),l().createElement(a.A,{className:"text-end text-right"},l().createElement(d.A,{type:"unstyled"},l().createElement(f.A,null,l().createElement("b",null,"Sails")),E.map(function(e){var t="";return e.reducedState&&e.reducedState.reefs&&(t=" (".concat(p()(e.reducedState.reefs)," reef)")),e.reducedState&&e.reducedState.furledRatio&&(t=" (".concat(100*e.reducedState.furledRatio,"% furled)")),l().createElement(f.A,{key:e.id,onClick:function(){}},e.name,t)}),!E.length&&l().createElement(y.A,{onClick:function(){}},"Edit"))))};var G=n(8447),Z=n(8702),F=n(1187),R=n(412),U=n(2237),W=n(8354),V=n(7185);const H=function(e){var t=e.entry;return l().createElement("div",null,l().createElement("p",null,t.text," ",t.category&&l().createElement(W.A,{color:"secondary",pill:!0},"#",t.category)," ",t.end&&l().createElement(W.A,{color:"secondary",pill:!0},"#trip-end")),l().createElement(V.A,{borderless:!0,striped:!0,size:"sm"},l().createElement("tbody",null,t.point&&l().createElement("tr",null,l().createElement("th",null,"Position"),l().createElement("td",null,t.point.toString()," ",t.position.source||"GPS")),t.speed&&!Number.isNaN(Number(t.speed.sog))&&l().createElement("tr",null,l().createElement("th",null,"Speed"),l().createElement("td",null,t.speed.sog,"kt")),!Number.isNaN(Number(t.course))&&l().createElement("tr",null,l().createElement("th",null,"Course"),l().createElement("td",null,t.course,"°")),!Number.isNaN(Number(t.heading))&&l().createElement("tr",null,l().createElement("th",null,"Heading"),l().createElement("td",null,t.heading,"°")),t.wind&&l().createElement("tr",null,l().createElement("th",null,"Wind"),l().createElement("td",null,Number.isNaN(Number(t.wind.speed))?"":"".concat(t.wind.speed,"kt "),Number.isNaN(Number(t.wind.direction))?"":"".concat(t.wind.direction,"°"))),t.observations&&!Number.isNaN(Number(t.observations.seaState))&&l().createElement("tr",null,l().createElement("th",null,"Sea"),l().createElement("td",null,t.observations.seaState+1,": ",["","Glassy calm (0m)","Rippled calm (0-0.1m)","Smooth (0.1-0.5m)","Slight (0.5-1.25m)","Moderate (1.25-2.5m)","Rough (2.5-4m)","Very rough (4-6m)","High (6-9m)","Very high (9-14m)","Phenomenal (14m+)"][t.observations.seaState+1])),t.observations&&!Number.isNaN(Number(t.observations.cloudCoverage))&&l().createElement("tr",null,l().createElement("th",null,"Clouds"),l().createElement("td",null,["◯","⌽","◔","◔","◑","◕","◕","⬤"][t.observations.cloudCoverage]," ",t.observations.cloudCoverage,"/8")),t.observations&&!Number.isNaN(Number(t.observations.visibility))&&l().createElement("tr",null,l().createElement("th",null,"Visibility"),l().createElement("td",null,t.observations.visibility+1,": ",["","Dense fog (<45m)","Thick fog (<180m)","Fog (<360m)","Moderate fog (<0.5NM)","Thin fog (<1NM)","Poor visibility (<2NM)","Moderate visibility (<5NM)","Good visibility (<10NM)","Very good visibility (<30NM)","Excellent visibility (>30NM)"][t.observations.visibility+1])),"engine"===t.category&&t.engine&&l().createElement("tr",null,l().createElement("th",null,"Engine"),l().createElement("td",null,Number.isNaN(Number(t.engine.hours))?"":"".concat(t.engine.hours,"h "))),"radio"===t.category&&t.vhf&&l().createElement("tr",null,l().createElement("th",null,"VHF channel"),l().createElement("td",null,Number.isNaN(Number(t.vhf))?"":"".concat(t.vhf))))))};function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach(function(t){Y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Y(e,t,n){return(t=function(e){var t=function(e){if("object"!=z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==z(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _=function(e){var t=e.entries.map(function(e){return $($({},e),{},{point:e.position?new U.Point(e.position.latitude,e.position.longitude):null,date:new Date(e.datetime)})});return t.reverse(),l().createElement("div",null,l().createElement(y.A,{color:"primary",onClick:e.addEntry},"Add entry"),t.map(function(t){return l().createElement(G.A,{key:t.datetime,onClick:function(){return e.editEntry(t)}},l().createElement(Z.A,null,l().createElement(o.A,null,l().createElement(a.A,{xs:"3"},t.author||"auto"),l().createElement(a.A,{className:"text-end text-right"},t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})))),l().createElement(F.A,null,l().createElement(R.A,null,l().createElement(H,{entry:t}))))}))};var q=n(937);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach(function(t){ee(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ee(e,t,n){return(t=function(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const te=function(e){var t=function(e){var t={};e.forEach(function(e){t[e.datetime]=e});var n=e.filter(function(t){return!e.some(function(e){return e.amends===t.datetime})}).map(function(e){for(var n=[e],r=e;r.amends;){var l=t[r.amends];if(!l)break;n.unshift(l),r=l}return n});return n.sort(function(e,t){return new Date(t[t.length-1].datetime)-new Date(e[e.length-1].datetime)}),n}(e.entries.map(function(e){return Q(Q({},e),{},{point:e.position?new U.Point(e.position.latitude,e.position.longitude):null,date:new Date(e.datetime)})}));return l().createElement("div",null,l().createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},l().createElement("div",{style:{fontWeight:"bold"}},"Logbook"),l().createElement(y.A,{color:"primary",onClick:e.addEntry},"Add entry")),l().createElement(V.A,{striped:!0,hover:!0,responsive:!0},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",null),l().createElement("th",null,"Time"),l().createElement("th",null,"Course"),l().createElement("th",null,"Speed"),l().createElement("th",null,"Weather"),l().createElement("th",null,"Coordinates"),l().createElement("th",null,"Fix"),l().createElement("th",null,"speed"),l().createElement("th",null,"Engine"),l().createElement("th",null,"By"),l().createElement("th",null,"Remarks"))),l().createElement("tbody",null,t.map(function(t,n){var r,o=t[t.length-1];return l().createElement(l().Fragment,{key:o.datetime},l().createElement("tr",{onClick:function(){return e.editEntry(o)}},l().createElement("td",null),l().createElement("td",null,o.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})),l().createElement("td",null,(r=o,Number.isNaN(Number(r.course))?Number.isNaN(Number(r.heading))?"":"HDT ".concat(r.heading,"°"):"".concat(r.course,"°"))),l().createElement("td",null,o.speed&&!Number.isNaN(Number(o.speed.sog))?"".concat(o.speed.sog,"kt"):""),l().createElement("td",null,function(e){var t=[];if(e.wind){var n=[];Number.isNaN(Number(e.wind.speed))||n.push("".concat(e.wind.speed,"kt")),Number.isNaN(Number(e.wind.direction))||n.push("".concat(e.wind.direction,"°")),n.length&&t.push("Wind ".concat(n.join(" ")))}return e.observations&&(Number.isNaN(Number(e.observations.seaState))||t.push("Sea state ".concat(e.observations.seaState)),Number.isNaN(Number(e.observations.cloudCoverage))||t.push("Clouds ".concat(e.observations.cloudCoverage,"/8")),Number.isNaN(Number(e.observations.visibility))||t.push("Visibility ".concat(e.observations.visibility+1))),t.join(", ")}(o)),l().createElement("td",null,o.point?o.point.toString():"n/a"),l().createElement("td",null,o.position?o.position.source||"GPS":""),l().createElement("td",null,o.speed&&!Number.isNaN(Number(o.speed.sog||o.speed.stw))?"".concat(Number(o.speed.sog||o.speed.stw),"kt"):""),l().createElement("td",null,o.engine&&!Number.isNaN(Number(o.engine.hours))?"".concat(o.engine.hours,"h"):""),l().createElement("td",null,o.author||"auto",!1===o.signatureValid&&l().createElement("span",{title:"Logikirje on muudetud või rikutud",style:{color:"red",marginLeft:4}},l().createElement(q.BS8,null))),l().createElement("td",null,o.text)),t.length>1&&t.slice(0,-1).map(function(t,n){return l().createElement("tr",{key:t.datetime,style:{background:"#f6f6f6",fontSize:"0.95em"}},l().createElement("td",null),l().createElement("td",{colSpan:11,style:{paddingLeft:48,borderLeft:"3px solid #bbb"}},l().createElement("span",{style:{color:"#888"}},l().createElement("b",null,t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone}))," — ",t.text)))}))}))),l().createElement(y.A,{color:"primary",onClick:e.addEntry},"Add entry"))};var ne=n(1425),re=n(2728);function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(e,t)||se(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach(function(t){ue(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ue(e,t,n){return(t=function(e){var t=function(e){if("object"!=le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==le(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ce(e){return function(e){if(Array.isArray(e))return me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||se(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){if(e){if("string"==typeof e)return me(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(e,t):void 0}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const de=function(e){var t=e.entries.filter(function(e){return e.position}).map(function(e){return ie(ie({},e),{},{point:new U.Point(e.position.latitude,e.position.longitude),date:new Date(e.datetime)})}),n=oe((0,r.useState)(t.map(function(e){return{lat:e.position.latitude,lon:e.position.longitude}})),2),o=n[0],a=n[1],i=oe((0,r.useState)([640,480]),2),u=i[0],c=i[1],s=(0,r.useRef)(null);(0,r.useEffect)(function(){if(s.current){var e=s.current.getBoundingClientRect();c([e.width,e.height])}},[]);var m=(0,re.R)(function(e){if(!e.length)return[0,0,0,0];var t=e.map(function(e){return e.lon}),n=e.map(function(e){return e.lat});return[Math.min.apply(Math,ce(n)),Math.min.apply(Math,ce(t)),Math.max.apply(Math,ce(n)),Math.max.apply(Math,ce(t))]}(o),u);m.zoom-=1.5,(0,r.useEffect)(function(){if(!(t.length<2)){var e=t.reduce(function(e,t){var n=t.datetime.substr(0,10);return-1===e.indexOf(n)&&e.push(n),e},[]),n=t[0].datetime,r=t[t.length-1].datetime;fetch("/signalk/v1/history/values?from=".concat(n,"&to=").concat(r,"&paths=navigation.position&resolution=").concat(300)).then(function(e){return e.json()}).then(function(t){if(t.data&&t.data.length){var n,r=[];t.data.forEach(function(t){if(t.length&&-1!==e.indexOf(t[0].substr(0,10))&&t[1]){var l=new U.Point(t[1][1],t[1][0]);n&&n.distanceTo(l)<.04||(n=l,r.push({lat:l.lat,lon:l.lon}))}}),a(r)}}).catch(function(){})}},[e.entries]);var d={type:"FeatureCollection",features:o.slice(1).map(function(e,t){var n=o[t];return!n||Number.isNaN(Number(n.lat))||Number.isNaN(Number(n.lon))||!e||Number.isNaN(Number(e.lat))||Number.isNaN(Number(e.lon))?null:{type:"feature",geometry:{type:"LineString",coordinates:[[n.lon,n.lat],[e.lon,e.lat]]}}}).filter(function(e){return null!==e})};return l().createElement("div",{ref:s,style:{width:"80vw",height:"80vh"}},l().createElement(ne.T5,{center:m.center,zoom:m.zoom},l().createElement(ne.s7,{data:d,styleCallback:function(){return{strokeWidth:"1",stroke:"red"}}}),t.map(function(t){var n="#009bdb";return"engine"===t.category&&(n="#ed1b2f"),"radio"===t.category&&(n="#00ae9d"),l().createElement(ne.pH,{key:t.datetime,color:n,anchor:[t.position.latitude,t.position.longitude],onClick:function(){return e.viewEntry(t)}})})))};var fe=n(2223);function ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ve(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ve(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const pe=function(e){var t=ye((0,r.useState)([]),2),n=t[0],o=t[1],a=ye((0,r.useState)(null),2),i=a[0],u=a[1],c=ye((0,r.useState)([]),2),s=c[0],m=c[1],d=ye((0,r.useState)(!1),2),f=d[0],v=d[1],p=ye((0,r.useState)(null),2),h=p[0],S=p[1];function A(e){return new Date(e).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}return(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){o(e.sort().reverse())}).catch(function(e){console.error("Error fetching days:",e)})},[]),l().createElement("div",null,l().createElement(G.A,null,l().createElement(Z.A,null,l().createElement("h4",null,"Service - Log Management"),l().createElement("p",{className:"text-muted mb-0"},"Delete log entries by day. This action cannot be undone.")),l().createElement(F.A,null,"success"===h&&l().createElement(fe.A,{color:"success",onDismiss:function(){return S(null)}},"Day deleted successfully!"),"error"===h&&l().createElement(fe.A,{color:"danger",onDismiss:function(){return S(null)}},"Error deleting day. Please try again."),l().createElement("div",{className:"row"},l().createElement("div",{className:"col-md-6"},l().createElement("h5",null,"Available Days"),l().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},n.map(function(e){return l().createElement(G.A,{key:e,className:"mb-2 ".concat(i===e?"border-primary":""),style:{cursor:"pointer"},onClick:function(){return function(e){u(e),fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()}).then(function(e){m(e)}).catch(function(e){console.error("Error fetching entries:",e),m([])})}(e)}},l().createElement(F.A,{className:"py-2"},l().createElement("div",{className:"d-flex justify-content-between align-items-center"},l().createElement("div",null,l().createElement("strong",null,A(e)),l().createElement("br",null),l().createElement("small",{className:"text-muted"},e)),i===e&&l().createElement(y.A,{color:"danger",size:"sm",onClick:function(e){e.stopPropagation(),v(!0)}},"Delete"))))}),0===n.length&&l().createElement("p",{className:"text-muted"},"No log entries found."))),l().createElement("div",{className:"col-md-6"},l().createElement("h5",null,"Entries for Selected Day"),i&&s.length>0?l().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},l().createElement(V.A,{size:"sm"},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",null,"Time"),l().createElement("th",null,"Category"),l().createElement("th",null,"Text"),l().createElement("th",null,"Author"))),l().createElement("tbody",null,s.map(function(t){return l().createElement("tr",{key:t.datetime},l().createElement("td",null,(n=t.datetime,new Date(n).toLocaleTimeString("en-GB",{timeZone:e.displayTimeZone||"UTC",hour:"2-digit",minute:"2-digit"}))),l().createElement("td",null,l().createElement("span",{className:"badge bg-".concat("navigation"===t.category?"primary":"engine"===t.category?"danger":"radio"===t.category?"success":"secondary")},t.category)),l().createElement("td",null,l().createElement("div",{style:{maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis"}},t.text)),l().createElement("td",null,t.author||"auto"));var n})))):i?l().createElement("p",{className:"text-muted"},"No entries found for this day."):l().createElement("p",{className:"text-muted"},"Select a day to view entries."))))),l().createElement(g.A,{isOpen:f,toggle:function(){return v(!1)}},l().createElement(b.A,{toggle:function(){return v(!1)}},"Confirm Delete"),l().createElement(E.A,null,"Are you sure you want to delete all log entries for ",l().createElement("strong",null,i?A(i):""),"?",l().createElement("br",null),l().createElement("br",null),"This action cannot be undone and will permanently remove ",s.length," log entries."),l().createElement(k.A,null,l().createElement(y.A,{color:"danger",onClick:function(){i&&(S("deleting"),fetch("/plugins/signalk-logbook/logs/".concat(i),{method:"DELETE"}).then(function(t){t.ok?(S("success"),o(n.filter(function(e){return e!==i})),u(null),m([]),e.onDataChange&&e.onDataChange()):S("error")}).catch(function(e){console.error("Error deleting day:",e),S("error")}))},disabled:"deleting"===h},"deleting"===h?"Deleting...":"Delete"),l().createElement(y.A,{color:"secondary",onClick:function(){return v(!1)}},"Cancel"))))};function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return be(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?be(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Ee(){var e,t,n=ge((0,r.useState)([]),2),i=n[0],u=n[1],c=ge((0,r.useState)(null),2),s=c[0],m=c[1],d=ge((0,r.useState)([]),2),f=d[0],y=d[1],v=ge((0,r.useState)(!0),2),p=v[0],g=v[1];return(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){u(e.sort().reverse()),g(!1)}).catch(function(e){console.error("Error fetching days:",e),g(!1)})},[]),p?l().createElement("div",null,"Loading..."):l().createElement("div",null,l().createElement(G.A,null,l().createElement(Z.A,null,l().createElement("h4",null,"Reports - Logbook Analysis")),l().createElement(F.A,null,l().createElement(o.A,null,l().createElement(a.A,{md:4},l().createElement("h5",null,"Available Days"),l().createElement("p",null,"Select a day to view reports"),l().createElement("div",{style:{maxHeight:"400px",overflowY:"auto"}},i.map(function(e){return l().createElement(G.A,{key:e,className:"mb-2 ".concat(s===e?"border-primary":""),style:{cursor:"pointer"},onClick:function(){return function(e){m(e),fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()}).then(function(e){return y(e)}).catch(function(e){console.error("Error fetching entries:",e),y([])})}(e)}},l().createElement(F.A,{className:"py-2"},l().createElement("div",{style:{fontWeight:"bold"}},e),l().createElement("small",{className:"text-muted"},"Click to view report")))}))),l().createElement(a.A,{md:8},l().createElement("h5",null,"Report Data"),s?l().createElement("div",null,l().createElement("p",null,l().createElement("strong",null,"Selected Day:")," ",s),l().createElement("p",null,l().createElement("strong",null,"Entries Found:")," ",f.length),f.length>0?l().createElement("div",null,l().createElement("h6",null,"Summary:"),l().createElement("ul",null,l().createElement("li",null,"Total entries: ",f.length),l().createElement("li",null,"First entry: ",(null===(e=f[0])||void 0===e?void 0:e.datetime)||"N/A"),l().createElement("li",null,"Last entry: ",(null===(t=f[f.length-1])||void 0===t?void 0:t.datetime)||"N/A"))):l().createElement("p",null,"No entries found for this day.")):l().createElement("p",null,"Select a day from the left panel to view detailed report data."))))))}var he=n(9575),Se=n(8332),Ae=n(9654),Ne=n(2113),we=n(8227),Oe=n(1909);function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach(function(t){Te(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Te(e,t,n){return(t=function(e){var t=function(e){if("object"!=ke(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ke(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ke(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return xe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function De(e){return null==e||isNaN(e)?null:Number((1.94384*e).toFixed(1))}const Ie=function(e){var t,n,o,a,i,u,c,s,m,d,f,v,p=e.entry&&void 0!==e.entry.ago,h=Pe((0,r.useState)({}),2),S=h[0],j=h[1],C=Pe((0,r.useState)(function(){return Ce(p?{text:"",category:e.categories[0]||"",ago:0,observations:{},position:e.entry&&e.entry.position?Ce({},e.entry.position):{}}:{},e.entry)}),2),T=C[0],P=C[1];(0,r.useEffect)(function(){P(Ce(p?{text:"",category:e.categories[0]||"",ago:0,observations:{},position:e.entry&&e.entry.position?Ce({},e.entry.position):{}}:{},e.entry))},[e.entry]),(0,r.useEffect)(function(){fetch("".concat(window.location.origin,"/signalk/v1/api/vessels/self"),{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(e){var t,n,r,l,o,a,i,u,c,s,m,d,f,y,v,g,b,E,h=(e&&e.environment||{}).wind||{},S=null==e||null===(t=e.environment)||void 0===t||null===(t=t.outside)||void 0===t||null===(t=t.pressure)||void 0===t?void 0:t.value,A=null==e||null===(n=e.environment)||void 0===n||null===(n=n.outside)||void 0===n||null===(n=n.visibility)||void 0===n?void 0:n.value,N=null!==(r=null!==(l=null===(o=h.speedTrue)||void 0===o?void 0:o.value)&&void 0!==l?l:null===(a=h.speedApparent)||void 0===a?void 0:a.value)&&void 0!==r?r:null===(i=h.speedOverGround)||void 0===i?void 0:i.value,w=null!==(u=null===(c=h.directionTrue)||void 0===c?void 0:c.value)&&void 0!==u?u:null===(s=h.directionMagnetic)||void 0===s?void 0:s.value,O=De(N),k={windSpeed:O,windDirection:null!=w?Math.round((180*Number(w)/Math.PI+360)%360):null,barometer:null!=S?Number(S)>2e3?Number((Number(S)/100).toFixed(2)):Number(Number(S).toFixed(2)):null,sog:De(null==e||null===(m=e.navigation)||void 0===m||null===(m=m.speedOverGround)||void 0===m?void 0:m.value),stw:De(null==e||null===(d=e.navigation)||void 0===d||null===(d=d.speedThroughWater)||void 0===d?void 0:d.value),cog:null!=(null==e||null===(f=e.navigation)||void 0===f||null===(f=f.courseOverGroundTrue)||void 0===f?void 0:f.value)?Math.round((180*Number(e.navigation.courseOverGroundTrue.value)/Math.PI+360)%360):null,hdt:null!=(null==e||null===(y=e.navigation)||void 0===y||null===(y=y.headingTrue)||void 0===y?void 0:y.value)?Math.round((180*Number(e.navigation.headingTrue.value)/Math.PI+360)%360):null,depth:null!==(v=null==e||null===(g=e.environment)||void 0===g||null===(g=g.depth)||void 0===g||null===(g=g.belowTransducer)||void 0===g?void 0:g.value)&&void 0!==v?v:null,waterTemp:null!=(null==e||null===(b=e.environment)||void 0===b||null===(b=b.water)||void 0===b||null===(b=b.temperature)||void 0===b?void 0:b.value)?Number(e.environment.water.temperature.value-273.15).toFixed(1):null,logNm:null!=(null==e||null===(E=e.navigation)||void 0===E||null===(E=E.log)||void 0===E?void 0:E.value)?Number((Number(e.navigation.log.value)/1852).toFixed(1)):null};j(k),p&&P(function(t){var n,r,l=Ce({},t);if((null!=O||null!=w)&&(l.wind=Ce({},l.wind||{}),null!=O&&(l.wind.speed=O),null!=w)){var o=Math.round((180*Number(w)/Math.PI+360)%360);l.wind.direction=o}l.observations=Ce({},l.observations||{}),null==l.observations.seaState&&null!=O&&(l.observations.seaState=function(e){if(null==e||isNaN(e))return null;var t=Number(e);return t<=1?0:t<=3?1:t<=6?2:t<=10?3:t<=16?4:t<=21?5:t<=27?6:t<=33?7:t<=40?8:t<=47?9:t<=55?10:t<=63?11:12}(O));var a,i=null==(a=A)||isNaN(a)?null:a<45?1:a<180?2:a<360?3:a<926?4:a<1852?5:a<3704?6:a<9260?7:a<18520?8:a<55560?9:10;if(null==l.observations.visibility&&null!=i&&(l.observations.visibility=i),null!=S){var u=Number(S);l.barometer=Number(u>2e3?(u/100).toFixed(2):u.toFixed(2))}var c=null!=(null==e||null===(n=e.navigation)||void 0===n||null===(n=n.log)||void 0===n?void 0:n.value)?e.navigation.log.value:null==e||null===(r=e.navigation)||void 0===r||null===(r=r.trip)||void 0===r||null===(r=r.log)||void 0===r?void 0:r.value;return null!=c&&(l.log=Number((Number(c)/1852).toFixed(1))),l})})},[p,e.entry]),(0,r.useEffect)(function(){p&&console.log("Add entry: props.entry.position =",e.entry&&e.entry.position)},[p,e.entry]);var x=[],D=T;if(e.allEntries&&T&&!p){for(var I=T;I.amends;){var M=e.allEntries.find(function(e){return e.datetime===I.amends});if(!M)break;I=M}for(var L=[I],B=e.allEntries.find(function(e){return e.amends===I.datetime});B;)L.push(B),B=e.allEntries.find(function(e){return e.amends===B.datetime});(x=[].concat(L).reverse()).length>1&&(D=x[x.length-1])}var G=[];function Z(e){var t=e.target,n=t.name,r=t.value,l=t.type;P(function(e){var t=Ce({},e);switch(n){case"seaState":case"cloudCoverage":case"visibility":t.observations=Ce({},t.observations);var o=parseInt(r,10);-1===o?delete t.observations[n]:t.observations[n]=o;break;case"latitude":case"longitude":case"source":t.position=Ce({},t.position),t.position[n]="source"===n?r:Number(r);break;case"ago":t.ago=parseInt(r,10);break;default:t[n]="number"===l?Number(r):r}return t})}x.length>1&&(G=x.slice(0,-1)),e.allEntries&&D&&!p&&e.allEntries.some(function(e){return e.amends===D.datetime}),e.allEntries&&D&&!p&&e.allEntries.filter(function(e){return e.datetime!==D.datetime}).sort(function(e,t){return new Date(t.datetime)-new Date(e.datetime)}).slice(0,5);var F=Pe((0,r.useState)(""),2),R=F[0],U=F[1];function W(e){return!!p||!function(e){return e&&("Automatic"===e.author||"Automatic log entry"===e.text)}(D)}return p&&T.ago&&Number(T.ago),p&&(!T.ago||Number(T.ago)),l().createElement(g.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},p?"New entry":"Log entry ".concat(new Date(D.date||D.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})," by ").concat(D.author||"auto")),l().createElement(E.A,null,l().createElement(A.A,null,l().createElement(N.A,null,l().createElement(w.A,{for:"text"},"Remarks"),G.length>0&&l().createElement("div",{style:{border:"1px solid #eee",borderRadius:4,padding:8,background:"#fafbfc",marginBottom:8}},l().createElement("div",{style:{fontWeight:"bold",marginBottom:4}},"Previous entries"),G.map(function(t){return l().createElement("div",{key:t.datetime,style:{marginBottom:6}},l().createElement("div",{style:{fontSize:"0.9em",color:"#888"}},new Date(t.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})),l().createElement("div",{style:{fontWeight:"bold"}},t.text))})),l().createElement(O.A,{id:"text",name:"text",type:"textarea",placeholder:"Tell what happened",value:T.text||"",onChange:Z,disabled:!W()})),l().createElement("div",{style:{borderTop:"1px solid #eee",marginTop:12,paddingTop:12}},l().createElement("div",{style:{fontWeight:"bold",marginBottom:8}},"Live readings"),l().createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:8}},l().createElement("div",null,"Wind: ",null!=S.windSpeed?"".concat(S.windSpeed," kt"):"n/a"," ",null!=S.windDirection?"(".concat(S.windDirection,"°)"):""),l().createElement("div",null,"Log: ",null!=S.logNm?"".concat(S.logNm," NM"):"n/a"),l().createElement("div",null,"SOG/STW: ",null!=S.sog?"".concat(S.sog," /"):""," ",null!=S.stw?"".concat(S.stw," kt"):""),l().createElement("div",null,"COG/HDT: ",null!=S.cog?"".concat(S.cog,"° /"):""," ",null!=S.hdt?"".concat(S.hdt,"°"):""),l().createElement("div",null,"Depth: ",null!=S.depth?"".concat(S.depth," m"):"n/a"),l().createElement("div",null,"Water temp: ",null!=S.waterTemp?"".concat(S.waterTemp," °C"):"n/a"))),x.length>1&&l().createElement(N.A,null,l().createElement(w.A,null,"Previous versions"),l().createElement("div",{style:{border:"1px solid #eee",borderRadius:4,padding:8,background:"#fafbfc"}},x.slice(0,-1).map(function(t){return l().createElement("div",{key:t.datetime,style:{marginBottom:6}},l().createElement("div",{style:{fontSize:"0.9em",color:"#888"}},new Date(t.datetime).toLocaleString("en-GB",{timeZone:e.displayTimeZone})),l().createElement("div",{style:{fontWeight:"bold"}},t.text))}))),p&&l().createElement(N.A,null,l().createElement(w.A,{for:"ago"},"This happened"),l().createElement(O.A,{id:"ago",name:"ago",type:"select",value:T.ago,onChange:Z,disabled:!W()},[0,5,10,15].map(function(e){return l().createElement("option",{key:e,value:e},e," minutes ago")}))),l().createElement(N.A,null,l().createElement(w.A,{for:"category"},"Category"),l().createElement(O.A,{id:"category",name:"category",type:"select",value:T.category||"",onChange:Z,disabled:!W()},e.categories.map(function(e){return l().createElement("option",{key:e,value:e},e)}))),"radio"===T.category&&l().createElement(N.A,null,l().createElement(w.A,{for:"vhf"},"VHF channel"),l().createElement(O.A,{id:"vhf",name:"vhf",placeholder:"16",value:T.vhf||"",onChange:Z,disabled:!W()})),"navigation"===T.category&&l().createElement(he.A,{open:R,toggle:function(e){U(R===e?"":e)}},l().createElement(Se.A,null,l().createElement(Ae.A,{targetId:"observations"},"Observations"),l().createElement(Ne.A,{accordionId:"observations"},l().createElement(N.A,null,l().createElement(w.A,{for:"seaState"},"Sea state"),l().createElement(O.A,{id:"seaState",name:"seaState",type:"select",value:null!==(t=null===(n=T.observations)||void 0===n?void 0:n.seaState)&&void 0!==t?t:-1,onChange:Z,disabled:!W()},["","Glassy calm (0m)","Rippled calm (0-0.1m)","Smooth (0.1-0.5m)","Slight (0.5-1.25m)","Moderate (1.25-2.5m)","Rough (2.5-4m)","Very rough (4-6m)","High (6-9m)","Very high (9-14m)","Phenomenal (14m+)"].map(function(e,t){return l().createElement("option",{key:t,value:t-1},e)}))),l().createElement(N.A,null,l().createElement(w.A,{for:"cloudCoverage"},"Cloud coverage"),l().createElement(we.A,null,l().createElement(O.A,{id:"cloudCoverage",name:"cloudCoverage",type:"range",min:"-1",max:"8",step:"1",value:null!==(o=null===(a=T.observations)||void 0===a?void 0:a.cloudCoverage)&&void 0!==o?o:-1,onChange:Z,disabled:!W()}),l().createElement(Oe.A,null,T.observations&&T.observations.cloudCoverage>-1?"".concat(T.observations.cloudCoverage,"/8"):"n/a"))),l().createElement(N.A,null,l().createElement(w.A,{for:"visibility"},"Visibility"),l().createElement(O.A,{id:"visibility",name:"visibility",type:"select",value:null!==(i=null===(u=T.observations)||void 0===u?void 0:u.visibility)&&void 0!==i?i:-1,onChange:Z,disabled:!W()},["","Dense fog (<45m)","Thick fog (<180m)","Fog (<360m)","Moderate fog (<0.5NM)","Thin fog (<1NM)","Poor visibility (<2NM)","Moderate visibility (<5NM)","Good visibility (<10NM)","Very good visibility (<30NM)","Excellent visibility (>30NM)"].map(function(e,t){return l().createElement("option",{key:t,value:t-1},e)}))))),l().createElement(Se.A,null,l().createElement(Ae.A,{targetId:"position"},"Position"),l().createElement(Ne.A,{accordionId:"position"},l().createElement(N.A,null,l().createElement(w.A,{for:"latitude"},"Latitude"),l().createElement(O.A,{id:"latitude",name:"latitude",type:"number",placeholder:"52.51117",max:"90",min:"-90",step:"0.00001",value:null!==(c=null===(s=T.position)||void 0===s?void 0:s.latitude)&&void 0!==c?c:"",onChange:Z,disabled:!1})),l().createElement(N.A,null,l().createElement(w.A,{for:"longitude"},"Longitude"),l().createElement(O.A,{id:"longitude",name:"longitude",type:"number",placeholder:"13.19329",max:"180",min:"-180",step:"0.00001",value:null!==(m=null===(d=T.position)||void 0===d?void 0:d.longitude)&&void 0!==m?m:"",onChange:Z,disabled:!1})),l().createElement(N.A,null,l().createElement(w.A,{for:"source"},"Fix type"),l().createElement(O.A,{id:"source",name:"source",type:"select",value:null!==(f=null===(v=T.position)||void 0===v?void 0:v.source)&&void 0!==f?f:"",onChange:Z,disabled:!1},["GPS","GNSS","Visual","Radar","Celestial","DR"].map(function(e){return l().createElement("option",{key:e,value:e},e)})))))))),l().createElement(k.A,null,l().createElement(y.A,{color:"primary",onClick:function(){if(T.text&&""!==T.text.trim()){var t=Ce({},T);if("navigation"!==t.category)delete t.position;else{var n,r,l,o=null===(n=t.position)||void 0===n?void 0:n.latitude,a=null===(r=t.position)||void 0===r?void 0:r.longitude,i=null===(l=t.position)||void 0===l?void 0:l.source;if(void 0!==o&&""!==o||!document.getElementById("latitude")||(o=document.getElementById("latitude").value),void 0!==a&&""!==a||!document.getElementById("longitude")||(a=document.getElementById("longitude").value),void 0!==i&&""!==i||!document.getElementById("source")||(i=document.getElementById("source").value),!o||!a)return void alert("Palun sisesta asukoht (latitude ja longitude)!");if(t.position={latitude:parseFloat(o),longitude:parseFloat(a),source:i||"GPS"},isNaN(t.position.latitude)||isNaN(t.position.longitude))return void alert("Latitude ja longitude peavad olema numbrid!")}t.datetime||(t.datetime=(new Date).toISOString()),e.save(t)}else alert("Logikirje tekst ('Remarks') on kohustuslik!")}},"Save")," ",l().createElement(y.A,{color:"secondary",onClick:e.cancel},"Cancel")))},Me=function(e){var t=e.entry;return l().createElement(g.A,{isOpen:!0,toggle:e.cancel},l().createElement(b.A,{toggle:e.cancel},"Log entry ",t.date.toLocaleString("en-GB",{timeZone:e.displayTimeZone})," by ",t.author||"auto"),l().createElement(E.A,null,l().createElement(H,{entry:t})),l().createElement(k.A,null,l().createElement(y.A,{color:"primary",onClick:function(){return e.editEntry(t)}},"Edit")," ",l().createElement(y.A,{color:"secondary",onClick:e.cancel},"Close")))};function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach(function(t){Ze(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Ze(e,t,n){return(t=function(e){var t=function(e){if("object"!=Le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Le(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Re(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Re(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var Ue=["navigation","engine","radio","maintenance"];const We=function(e){var t=Fe((0,r.useState)({entries:[]}),2),n=t[0],d=t[1],f=Fe((0,r.useState)("timeline"),2),y=f[0],v=f[1],p=Fe((0,r.useState)(7),2),g=p[0],b=p[1],E=Fe((0,r.useState)(null),2),h=E[0],S=E[1],A=Fe((0,r.useState)(null),2),N=A[0],w=A[1],O=Fe((0,r.useState)(null),2),k=O[0],j=O[1],C=Fe((0,r.useState)(!0),2),T=C[0],P=C[1],x=Fe((0,r.useState)("UTC"),2),D=x[0],I=x[1],M=Fe((0,r.useState)(""),2),L=M[0],G=M[1],Z=Fe((0,r.useState)(null),2),F=(Z[0],Z[1]),R=Fe((0,r.useState)(null),2),U=R[0],W=R[1],V=e.loginStatus.status;function H(e){var t=Ge({},e);delete t.signatureValid,delete t.audit,fetch("/plugins/signalk-logbook/logs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){j(null),P(!0)})}return(0,r.useEffect)(function(){function e(){fetch("/signalk/v1/api/vessels/self/").then(function(e){return e.json()}).then(function(e){var t=null;e&&e.navigation&&e.navigation.position&&e.navigation.position.value&&(t=e.navigation.position.value),t&&"number"==typeof t.latitude&&"number"==typeof t.longitude&&W({latitude:t.latitude,longitude:t.longitude,source:"GPS"})})}e();var t=setInterval(e,5e3);return function(){return clearInterval(t)}},[]),(0,r.useEffect)(function(){if(T&&"notLoggedIn"!==V){var e=setInterval(function(){P(!0)},3e5);return fetch("/plugins/signalk-logbook/logs").then(function(e){return e.json()}).then(function(e){var t=new Date;t.setDate(t.getDate()-g);var n=e.filter(function(e){return e>=t.toISOString().substr(0,10)});Promise.all(n.map(function(e){return fetch("/plugins/signalk-logbook/logs/".concat(e)).then(function(e){return e.json()})})).then(function(e){var t=[].concat.apply([],e);d({entries:t}),P(!1);var n=t.filter(function(e){return"navigation"===e.category&&e.position&&void 0!==e.position.latitude&&void 0!==e.position.longitude}).sort(function(e,t){return new Date(t.datetime)-new Date(e.datetime)})[0];n&&F(Ge({},n.position))})}),function(){clearInterval(e)}}},[g,T,V]),(0,r.useEffect)(function(){fetch("/signalk/v1/applicationData/user/signalk-logbook/1.0").then(function(e){return e.json()}).then(function(e){e&&e.filter&&e.filter.daysToShow&&b(e.filter.daysToShow)})},[V]),(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/config").then(function(e){return e.json()}).then(function(e){e.configuration&&e.configuration.displayTimeZone&&I(e.configuration.displayTimeZone)})},[D]),(0,r.useEffect)(function(){fetch("/plugins/signalk-logbook/version").then(function(e){return e.json()}).then(function(e){e&&e.version&&G(e.version)})},[]),"notLoggedIn"===e.loginStatus.status&&e.loginStatus.authenticationRequired?l().createElement(e.adminUI.Login,null):l().createElement("div",null,l().createElement(B,{adminUI:e.adminUI,loginStatus:e.loginStatus,daysToShow:g,setDaysToShow:b,setNeedsUpdate:P}),l().createElement(o.A,null,h?l().createElement(Ie,{entry:h,cancel:function(){return S(null)},save:function(e){if(e.datetime&&!Number.isNaN(Date.parse(e.datetime))){var t=Ge(Ge({},e),{},{amends:e.datetime,datetime:(new Date).toISOString()});return delete t.point,delete t.date,delete t.signatureValid,void fetch("/plugins/signalk-logbook/logs/".concat(e.datetime.substr(0,10),"/").concat(e.datetime),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){S(null),P(!0)})}H(e)},delete:function(e){var t=new Date(e.datetime).toISOString().substr(0,10);fetch("/plugins/signalk-logbook/logs/".concat(t,"/").concat(e.datetime),{method:"DELETE"}).then(function(){S(null),P(!0)})},categories:Ue,displayTimeZone:D,allEntries:n.entries}):null,N?l().createElement(Me,{entry:N,editEntry:S,cancel:function(){return w(null)},categories:Ue,displayTimeZone:D}):null,k?l().createElement(Ie,{entry:k,cancel:function(){return j(null)},save:H,categories:Ue}):null,l().createElement(a.A,{className:"bg-light border"},l().createElement(i.A,{tabs:!0},l().createElement(u.A,null,l().createElement(c.A,{className:"timeline"===y?"active":"",onClick:function(){return v("timeline")}},"Timeline")),l().createElement(u.A,null,l().createElement(c.A,{className:"book"===y?"active":"",onClick:function(){v("book"),e.adminUI.hideSideBar()}},"Logbook")),l().createElement(u.A,null,l().createElement(c.A,{className:"map"===y?"active":"",onClick:function(){return v("map")}},"Map")),l().createElement(u.A,null,l().createElement(c.A,{className:"service"===y?"active":"",onClick:function(){return v("service")}},"Service")),l().createElement(u.A,null,l().createElement(c.A,{className:"reports"===y?"active":"",onClick:function(){return v("reports")}},"Reports"))),l().createElement(s.A,{activeTab:y},l().createElement(m.A,{tabId:"timeline"},"timeline"===y?l().createElement(_,{entries:n.entries,displayTimeZone:D,editEntry:S,addEntry:function(){return j({ago:0,category:"navigation",position:U})}}):null),l().createElement(m.A,{tabId:"book"},"book"===y?l().createElement(te,{entries:n.entries,displayTimeZone:D,editEntry:S,addEntry:function(){return j({ago:0,category:"navigation",position:U})}}):null),l().createElement(m.A,{tabId:"map"},"map"===y?l().createElement(de,{entries:n.entries,editEntry:S,viewEntry:w}):null),l().createElement(m.A,{tabId:"service"},"service"===y?l().createElement(pe,{displayTimeZone:D,onDataChange:function(){return P(!0)}}):null),l().createElement(m.A,{tabId:"reports"},"reports"===y?l().createElement(Ee,{displayTimeZone:D}):null)))),l().createElement("div",{style:{fontFamily:"monospace",fontSize:"1.2em",color:"#007bff"}},"Plugin version ",L||"..."," (live test)"))}}}]);